<!DOCTYPE html>
<html lang="en" dir="ltr"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.144.2">
<title>SQL Data Warehouse from Scratch - Part I | Shivam Chhetry</title>


<meta property="twitter:site" content="@apreshill">
<meta property="twitter:creator" content="@apreshill">







  
    
  
<meta name="description" content="Social icons may appear on several pages throughout your site. Learn how to set them up, and control where they show up.">


<meta property="og:site_name" content="Shivam Chhetry">
<meta property="og:title" content="SQL Data Warehouse from Scratch - Part I | Shivam Chhetry">
<meta property="og:description" content="Social icons may appear on several pages throughout your site. Learn how to set them up, and control where they show up." />
<meta property="og:type" content="page" />
<meta property="og:url" content="http://localhost:1313/blog/social/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="http://localhost:1313/blog/social/featured.jpg" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="http://localhost:1313/blog/social/featured.jpg" >
    
    
  
  <meta itemprop="name" content="SQL Data Warehouse from Scratch - Part I">
  <meta itemprop="description" content="Data Warehouse and Analytics Project Welcome to the Data Warehouse and Analytics Project
this project demonstrates a comprehensive data warehousing and analytics solution, from building a data warehouse to generating actionable insights. designed as a portfolio project, it highlights industry best practices in data engineering and analytics.
üìñ Project Overview This project involves:">
  <meta itemprop="datePublished" content="2024-11-12T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-11-12T00:00:00+00:00">
  <meta itemprop="wordCount" content="10487">
  <meta itemprop="image" content="http://localhost:1313/blog/social/featured.jpg">
  <meta itemprop="keywords" content="SQL,Data Analysis">
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/website_icon.png" type="image/x-icon">
  <link rel="icon" href="/img/website_icon.png" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.a8b032ca5f24551ab005285e3d04061302e89e91ededd85a2bd7e19884d1f11e.css" integrity="sha256-qLAyyl8kVRqwBShePQQGEwLonpHt7dhaK9fhmITR8R4=" media="screen">
  
  
  <script src="/panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="/main.min.c793459ded39f47482c177c2f8967f9ea2b91b4225a969d3909bd20c512c082d.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container single">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="http://localhost:1313/" title="Home">
      <img src="/img/new_logo.png" class="dib db-l h2 w-auto" alt="Shivam Chhetry">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About Blogophonic">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/blog/" title="Blog">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Project Portfolio">Projects</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/talk/" title="Talks">Talks</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/collection/" title="A collection">A collection</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/elements/" title="Element Page">Elements</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">SQL Data Warehouse from Scratch - Part I</h1>
        <h4 class="f4 mt0 mb4 lh-title measure">Social icons may appear on several pages throughout your site. Learn how to set them up, and control where they show up.</h4>
        <p class="f6 measure lh-copy mv1">By Shivam Chhetry in <a href="http://localhost:1313/categories/sql">SQL</a>  <a href="http://localhost:1313/categories/data-analysis">Data Analysis</a> </p>
        <p class="f7 db mv0 ttu">November 12, 2024</p>

      

      </header>
      <section class="post-body pt5 pb4">
        



<h1 id="data-warehouse-and-analytics-project"><strong><code>Data Warehouse and Analytics Project</code></strong>
  <a href="#data-warehouse-and-analytics-project"></a>
</h1>
<p>Welcome to the <strong>Data Warehouse and Analytics Project</strong></p>
<p>this project demonstrates a comprehensive data warehousing and analytics solution, from building a data warehouse to generating actionable insights. designed as a portfolio project, it highlights industry best practices in data engineering and analytics.</p>
<hr>




<h2 id="-project-overview">üìñ Project Overview
  <a href="#-project-overview"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>This project involves:</p>
<ol>
<li><strong>Data Architecture</strong>: Designing a Modern Data Warehouse Using Medallion Architecture <strong>Bronze</strong>, <strong>Silver</strong>, and <strong>Gold</strong> layers.</li>
<li><strong>ETL Pipelines</strong>: Extracting, transforming, and loading data from source systems into the warehouse.</li>
<li><strong>Data Modeling</strong>: Developing fact and dimension tables optimized for analytical queries.</li>
<li><strong>Analytics &amp; Reporting</strong>: Creating SQL-based reports and dashboards for actionable insights.</li>
</ol>
<p>üéØ This repository is an excellent resource for professionals and students looking to showcase expertise in:</p>
<ul>
<li>SQL Development</li>
<li>Data Architect</li>
<li>Data Engineering</li>
<li>ETL Pipeline Developer</li>
<li>Data Modeling</li>
<li>Data Analytics</li>
</ul>
<hr>




<h2 id="-important-links--tools">üõ†Ô∏è Important Links &amp; Tools:
  <a href="#-important-links--tools"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Everything is for Free!</p>
<ul>
<li>
<a href="https://www.notion.so/datasets/" target="_blank" rel="noopener">**Datasets</a>:** Access to the project dataset (csv files).</li>
<li>
<a href="https://www.microsoft.com/en-us/sql-server/sql-server-downloads" target="_blank" rel="noopener">**SQL Server Express</a>:** Lightweight server for hosting your SQL database.</li>
<li>
<a href="https://learn.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver16" target="_blank" rel="noopener">**SQL Server Management Studio (SSMS)</a>:** GUI for managing and interacting with databases.</li>
<li>
<a href="https://github.com/" target="_blank" rel="noopener">**Git Repository</a>:** Set up a GitHub account and repository to manage, version, and collaborate on your code efficiently.</li>
<li>
<a href="https://www.drawio.com/" target="_blank" rel="noopener">**DrawIO</a>:** Design data architecture, models, flows, and diagrams.</li>
<li>
<a href="https://www.notion.com/" target="_blank" rel="noopener">**Notion</a>:** All-in-one tool for project management and organization.</li>
<li>
<a href="https://www.notion.so/16ed041640ef80489667cfe2f380b269?pvs=21" target="_blank" rel="noopener">**Notion Project Steps</a>:** Access to All Project Phases and Tasks.</li>
</ul>
<hr>




<h2 id="-project-requirements">üöÄ Project Requirements
  <a href="#-project-requirements"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="building-the-data-warehouse-data-engineering">Building the Data Warehouse (Data Engineering)
  <a href="#building-the-data-warehouse-data-engineering"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>




<h3 id="objective">Objective
  <a href="#objective"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Develop a modern data warehouse using SQL Server to consolidate sales data, enabling analytical reporting and informed decision-making.</p>




<h3 id="specifications">Specifications
  <a href="#specifications"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>Data Sources</strong>: Import data from two source systems (ERP and CRM) provided as CSV files.</li>
<li><strong>Data Quality</strong>: Cleanse and resolve data quality issues prior to analysis.</li>
<li><strong>Integration</strong>: Combine both sources into a single, user-friendly data model designed for analytical queries.</li>
<li><strong>Scope</strong>: Focus on the latest dataset only; historization of data is not required.</li>
<li><strong>Documentation</strong>: Provide clear documentation of the data model to support both business stakeholders and analytics teams.</li>
</ul>
<hr>




<h3 id="bi-analytics--reporting-data-analysis">BI: Analytics &amp; Reporting (Data Analysis)
  <a href="#bi-analytics--reporting-data-analysis"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>




<h3 id="objective-1">Objective
  <a href="#objective-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Develop SQL-based analytics to deliver detailed insights into:</p>
<ul>
<li><strong>Customer Behavior</strong></li>
<li><strong>Product Performance</strong></li>
<li><strong>Sales Trends</strong></li>
</ul>
<p>These insights empower stakeholders with key business metrics, enabling strategic decision-making.</p>
<p>For more details, refer to 
<a href="https://www.notion.so/docs/requirements.md" target="_blank" rel="noopener">docs/requirements.md</a>.</p>
<hr>




<h2 id="-data-architecture">üèóÔ∏è Data Architecture
  <a href="#-data-architecture"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>The data architecture for this project follows Medallion Architecture <strong>Bronze</strong> , <strong>Silver</strong>, and <strong>Gold</strong> layers:</p>
<ol>
<li><strong>Bronze Layer</strong>: Stores raw data as-is from the source systems. Data is ingested from CSV Files into SQL Server Database.</li>
<li><strong>Silver Layer</strong>: This layer includes data cleansing, standardization, and normalization processes to prepare data for analysis.</li>
<li><strong>Gold Layer</strong>: Houses business-ready data modeled into a star schema required for reporting and analytics.</li>
</ol>
<p><img src="data_architecture.png" alt="data_architecture.png"></p>
<hr>




<h2 id="-repository-structure">üìÇ Repository Structure
  <a href="#-repository-structure"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<pre tabindex="0"><code>data-warehouse-project/
‚îÇ
‚îú‚îÄ‚îÄ datasets/                           # Raw datasets used for the project (ERP and CRM data)
‚îÇ
‚îú‚îÄ‚îÄ docs/                               # Project documentation and architecture details
‚îÇ   ‚îú‚îÄ‚îÄ etl.drawio                      # Draw.io file shows all different techniquies and methods of ETL
‚îÇ   ‚îú‚îÄ‚îÄ data_architecture.drawio        # Draw.io file shows the project&#39;s architecture
‚îÇ   ‚îú‚îÄ‚îÄ data_catalog.md                 # Catalog of datasets, including field descriptions and metadata
‚îÇ   ‚îú‚îÄ‚îÄ data_flow.drawio                # Draw.io file for the data flow diagram
‚îÇ   ‚îú‚îÄ‚îÄ data_models.drawio              # Draw.io file for data models (star schema)
‚îÇ   ‚îú‚îÄ‚îÄ naming-conventions.md           # Consistent naming guidelines for tables, columns, and files
‚îÇ
‚îú‚îÄ‚îÄ scripts/                            # SQL scripts for ETL and transformations
‚îÇ   ‚îú‚îÄ‚îÄ bronze/                         # Scripts for extracting and loading raw data
‚îÇ   ‚îú‚îÄ‚îÄ silver/                         # Scripts for cleaning and transforming data
‚îÇ   ‚îú‚îÄ‚îÄ gold/                           # Scripts for creating analytical models
‚îÇ
‚îú‚îÄ‚îÄ tests/                              # Test scripts and quality files
‚îÇ
‚îú‚îÄ‚îÄ README.md                           # Project overview and instructions
‚îú‚îÄ‚îÄ LICENSE                             # License information for the repository
‚îú‚îÄ‚îÄ .gitignore                          # Files and directories to be ignored by Git
‚îî‚îÄ‚îÄ requirements.txt                    # Dependencies and requirements for the project
</code></pre><hr>
<p>Let‚Äôs start with building Data Warehouse</p>




<h2 id="create-database-and-schemas">Create Database and Schemas
  <a href="#create-database-and-schemas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">/*
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">=============================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">Create Database and Schemas
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">=============================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">Script Purpose:
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    This script creates a new database named &#39;DataWarehouse&#39; after checking if it already exists.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    If the database exists, it is dropped and recreated. Additionally, the script sets up three schemas
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    within the database: &#39;bronze&#39;, &#39;silver&#39;, and &#39;gold&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">WARNING:
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    Running this script will drop the entire &#39;DataWarehouse&#39; database if it exists.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    All data in the database will be permanently deleted. Proceed with caution
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    and ensure you have proper backups before running this script.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">*/</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span>USE<span style="color:#fff"> </span>master<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Drop and recreate the &#39;DataWarehouse&#39; database
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span><span style="color:#cf222e">EXISTS</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>sys<span style="color:#1f2328">.</span>databases<span style="color:#fff"> </span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>name<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;DataWarehouse&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">BEGIN</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">ALTER</span><span style="color:#fff"> </span><span style="color:#cf222e">DATABASE</span><span style="color:#fff"> </span>DataWarehouse<span style="color:#fff"> </span><span style="color:#cf222e">SET</span><span style="color:#fff"> </span>SINGLE_USER<span style="color:#fff"> </span><span style="color:#cf222e">WITH</span><span style="color:#fff"> </span><span style="color:#cf222e">ROLLBACK</span><span style="color:#fff"> </span><span style="color:#cf222e">IMMEDIATE</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">DATABASE</span><span style="color:#fff"> </span>DataWarehouse<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">END</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Create the &#39;DataWarehouse&#39; database
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">DATABASE</span><span style="color:#fff"> </span>DataWarehouse<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span>USE<span style="color:#fff"> </span>DataWarehouse<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Create Schemas
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">SCHEMA</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">SCHEMA</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">SCHEMA</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h1 id="creating-bronze-tables-understanding-the-sql-ddl-script"><strong>Creating Bronze Tables: Understanding the SQL DDL Script</strong>
  <a href="#creating-bronze-tables-understanding-the-sql-ddl-script"></a>
</h1>
<hr>
<p>In modern data architecture, it&rsquo;s common to define multiple stages in the data pipeline. These stages are often referred to as <strong>bronze</strong>, <strong>silver</strong>, and <strong>gold</strong>. The <strong>bronze</strong> layer typically contains raw, untransformed data, often loaded directly from source systems. The <strong>silver</strong> layer contains cleaned and processed data, and the <strong>gold</strong> layer represents data that has been fully aggregated and transformed for business reporting.</p>
<p>This script is designed to create tables in the <strong>bronze</strong> schema, which is the first stage in our data processing pipeline. The <code>bronze</code> schema contains raw data that we can further process and refine in the later stages. Let&rsquo;s break down the purpose and functionality of the script step-by-step:</p>
<hr>




<h3 id="1-checking-and-dropping-existing-tables"><strong>1. Checking and Dropping Existing Tables</strong>
  <a href="#1-checking-and-dropping-existing-tables"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Each table in the <code>bronze</code> schema is checked for existence before it is created. If a table already exists, it is dropped to ensure that the script can run without errors and the schema is defined from scratch.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.crm_cust_info&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span></code></pre></div><p>The <code>OBJECT_ID</code> function checks whether a table with the specified name (<code>bronze.crm_cust_info</code> in this case) exists in the database. The <code>'U'</code> parameter specifies that we are looking for user-defined tables. If the table exists, it is dropped using the <code>DROP TABLE</code> statement.</p>
<p>This same pattern is repeated for each table in the <code>bronze</code> schema.</p>
<hr>




<h3 id="2-creating-new-tables-in-the-bronze-schema"><strong>2. Creating New Tables in the Bronze Schema</strong>
  <a href="#2-creating-new-tables-in-the-bronze-schema"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Once existing tables are dropped, new tables are created to hold the raw data in the <code>bronze</code> schema. These tables are designed with appropriate columns and data types to capture key information.</p>




<h3 id="table-crm_"><strong>Table: crm_cust_info</strong>
  <a href="#table-crm_"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>This table stores customer information such as customer ID, key, name, marital status, gender, and creation date.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_key<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_firstname<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_lastname<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_marital_status<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_gndr<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_create_date<span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong>cst_id</strong>: A unique integer ID for each customer.</li>
<li><strong>cst_key</strong>: A unique key representing the customer.</li>
<li><strong>cst_firstname</strong> and <strong>cst_lastname</strong>: The customer&rsquo;s first and last names.</li>
<li><strong>cst_marital_status</strong> and <strong>cst_gndr</strong>: The customer&rsquo;s marital status and gender.</li>
<li><strong>cst_create_date</strong>: The date the customer record was created.</li>
</ul>




<h3 id="table-crm_-1"><strong>Table: crm_prd_info</strong>
  <a href="#table-crm_-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>This table stores product-related information, including product ID, key, name, cost, and sales timeline.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_id<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_key<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_nm<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_cost<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_line<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_start_dt<span style="color:#fff"> </span>DATETIME<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_end_dt<span style="color:#fff"> </span>DATETIME<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong>prd_id</strong>: Unique product ID.</li>
<li><strong>prd_key</strong>: Unique product key.</li>
<li><strong>prd_nm</strong>: Product name.</li>
<li><strong>prd_cost</strong>: The cost of the product.</li>
<li><strong>prd_line</strong>: The product line or category.</li>
<li><strong>prd_start_dt</strong> and <strong>prd_end_dt</strong>: The start and end dates for the product‚Äôs lifecycle.</li>
</ul>




<h3 id="table-crm_-2"><strong>Table: crm_sales_details</strong>
  <a href="#table-crm_-2"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>This table stores sales order details, including order number, product key, customer ID, order dates, and sales quantities.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_ord_num<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_prd_key<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_cust_id<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_ship_dt<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_due_dt<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_sales<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_quantity<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_price<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong>sls_ord_num</strong>: Sales order number.</li>
<li><strong>sls_prd_key</strong>: The product key related to the sales order.</li>
<li><strong>sls_cust_id</strong>: Customer ID who placed the order.</li>
<li><strong>sls_order_dt</strong>, <strong>sls_ship_dt</strong>, <strong>sls_due_dt</strong>: Order, shipment, and due dates (all stored as integers, potentially representing dates in <code>YYYYMMDD</code> format).</li>
<li><strong>sls_sales</strong>, <strong>sls_quantity</strong>, <strong>sls_price</strong>: Sales amount, quantity of products sold, and price for the product.</li>
</ul>




<h3 id="other-tables-in-the-bronze-schema"><strong>Other Tables in the Bronze Schema</strong>
  <a href="#other-tables-in-the-bronze-schema"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>erp_loc_a101</strong>: This table likely contains location data related to some entity, storing a country and its associated ID.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cid<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cntry<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong>erp_cust_az12</strong>: This table seems to store basic customer information such as ID, birthdate, and gender.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cid<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>bdate<span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>gen<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong>erp_px_cat_g1v2</strong>: This table likely holds product category and subcategory information for items in an ERP system.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>id<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cat<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>subcat<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>maintenance<span style="color:#fff"> </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><hr>




<h3 id="why-drop-existing-tables"><strong>Why Drop Existing Tables?</strong>
  <a href="#why-drop-existing-tables"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Dropping the tables before creating new ones ensures that you don‚Äôt encounter issues if there have been schema changes or updates since the last time the script was run. This is especially useful in development or testing environments where you might need to refresh the schema frequently.</p>
<p>In production environments, however, you might consider using migration strategies or version control for database schemas to avoid data loss.</p>
<hr>




<h3 id="here-is-the-full-sql-script">Here is the Full SQL script
  <a href="#here-is-the-full-sql-script"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">/*
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">===============================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">DDL Script: Create Bronze Tables
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">===============================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">Script Purpose:
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    This script creates tables in the &#39;bronze&#39; schema, dropping existing tables
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    if they already exist.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">	  Run this script to re-define the DDL structure of &#39;bronze&#39; Tables
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">===============================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">*/</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.crm_cust_info&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#fff">              </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_key<span style="color:#fff">             </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_firstname<span style="color:#fff">       </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_lastname<span style="color:#fff">        </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_marital_status<span style="color:#fff">  </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_gndr<span style="color:#fff">            </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_create_date<span style="color:#fff">     </span><span style="color:#6639ba">DATE</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.crm_prd_info&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_id<span style="color:#fff">       </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_key<span style="color:#fff">      </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_nm<span style="color:#fff">       </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_cost<span style="color:#fff">     </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_line<span style="color:#fff">     </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_start_dt<span style="color:#fff"> </span>DATETIME<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_end_dt<span style="color:#fff">   </span>DATETIME<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.crm_sales_details&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_ord_num<span style="color:#fff">  </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_prd_key<span style="color:#fff">  </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_cust_id<span style="color:#fff">  </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_ship_dt<span style="color:#fff">  </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_due_dt<span style="color:#fff">   </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_sales<span style="color:#fff">    </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_quantity<span style="color:#fff"> </span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_price<span style="color:#fff">    </span><span style="color:#6639ba">INT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.erp_loc_a101&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cid<span style="color:#fff">    </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cntry<span style="color:#fff">  </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.erp_cust_az12&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cid<span style="color:#fff">    </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>bdate<span style="color:#fff">  </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>gen<span style="color:#fff">    </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;bronze.erp_px_cat_g1v2&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>id<span style="color:#fff">           </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cat<span style="color:#fff">          </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>subcat<span style="color:#fff">       </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>maintenance<span style="color:#fff">  </span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GO</span><span style="color:#fff">
</span></span></span></code></pre></div><hr>




<h3 id="check-for-nulls-or-duplicates-in-primary-key">Check for NULLs or Duplicates in Primary Key
  <a href="#check-for-nulls-or-duplicates-in-primary-key"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<hr>




<h3 id="sql-query-to-find-duplicate-or-null-cst_id-with-their-counts">SQL Query to Find Duplicate or Null <code>cst_id</code> with Their Counts
  <a href="#sql-query-to-find-duplicate-or-null-cst_id-with-their-counts"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>When working with customer data, it&rsquo;s often essential to spot potential data quality issues, such as duplicates or null values. In this post, I&rsquo;ll walk you through an SQL query that helps identify such issues in the <code>cst_id</code> field from the <code>bronze.crm_cust_info</code> table.</p>
<p>Let&rsquo;s dive into the query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">     </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">     </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>no_of_counts<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="1-select">1. <strong><code>SELECT</code> Clause</strong>:
  <a href="#1-select"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The first part of the query is the <code>SELECT</code> clause, which is where we define what data we want to retrieve from the database. In this case, we want to retrieve the <code>cst_id</code> and the count of how many times each <code>cst_id</code> appears in the table. The <code>COUNT(*)</code> function will count all the rows for each <code>cst_id</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">     </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">     </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>no_of_counts<span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong><code>cst_id</code></strong>: This represents the unique customer identifier in the table.</li>
<li><strong><code>COUNT(*) AS no_of_counts</code></strong>: This counts how many times each <code>cst_id</code> appears. We alias this count as <code>no_of_counts</code> for better readability.</li>
</ul>




<h3 id="2-from">2. <strong><code>FROM</code> Clause</strong>:
  <a href="#2-from"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The <code>FROM</code> clause tells the database which table to pull the data from. In this case, we&rsquo;re working with the <code>bronze.crm_cust_info</code> table, which presumably contains customer information.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="3-group-by">3. <strong><code>GROUP BY</code> Clause</strong>:
  <a href="#3-group-by"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Now, we&rsquo;re interested in counting the occurrences of each <code>cst_id</code>. To do this, we group the data by <code>cst_id</code>. This means that for each unique <code>cst_id</code>, we&rsquo;ll aggregate the rows together and count how many times that <code>cst_id</code> appears.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="4-having">4. <strong><code>HAVING</code> Clause</strong>:
  <a href="#4-having"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The <code>HAVING</code> clause comes into play after the grouping, and it allows us to filter out results based on the aggregate values.</p>
<p>In this case, we&rsquo;re interested in <code>cst_id</code>s that either:</p>
<ul>
<li>Appear more than once (<code>COUNT(*) &gt; 1</code>), which indicates a duplicate.</li>
<li>Or, the <code>cst_id</code> is <code>NULL</code>, which is another common issue in databases that we might want to address.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="5-the-result">5. <strong>The Result:</strong>
  <a href="#5-the-result"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Once the query is run, the result looks something like this:</p>
<table>
  <thead>
      <tr>
          <th><strong>cst_id</strong></th>
          <th><strong>no_of_counts</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>29449</td>
          <td>2</td>
      </tr>
      <tr>
          <td>29473</td>
          <td>2</td>
      </tr>
      <tr>
          <td>29433</td>
          <td>2</td>
      </tr>
      <tr>
          <td>NULL</td>
          <td>3</td>
      </tr>
      <tr>
          <td>29483</td>
          <td>2</td>
      </tr>
      <tr>
          <td>29466</td>
          <td>3</td>
      </tr>
  </tbody>
</table>
<p>From the output, we can easily spot:</p>
<ul>
<li>Duplicate <code>cst_id</code>s, such as <code>29449</code>, <code>29473</code>, and <code>29433</code>, which each appear twice.</li>
<li>Null values in the <code>cst_id</code> column, which might indicate incomplete data (3 occurrences in this case).</li>
</ul>




<h3 id="6-why-is-this-useful">6. <strong>Why Is This Useful?</strong>
  <a href="#6-why-is-this-useful"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>This query is really helpful in data cleaning and validation. You can use it to identify:</p>
<ul>
<li>Duplicate entries that might lead to skewed analysis or incorrect reporting.</li>
<li><code>NULL</code> values that could represent missing or unprocessed data.</li>
</ul>
<p>In a real-world scenario, once you find these duplicates or nulls, you can either:</p>
<ul>
<li>Investigate why these entries are duplicated and fix the underlying issue.</li>
<li>Decide whether to handle null values by filling them with a placeholder value or removing those rows from your dataset.</li>
</ul>
<hr>




<h3 id="investigating-a-duplicate-cst_id-to-explore-the-data-further">Investigating a Duplicate <code>cst_id</code> to Explore the Data Further
  <a href="#investigating-a-duplicate-cst_id-to-explore-the-data-further"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>After identifying that <code>cst_id = 29466</code> is a duplicate, let‚Äôs now dive deeper into the data associated with this particular <code>cst_id</code>. In the previous step, we ran a query to identify duplicate entries, but now we want to understand the actual data for this customer. Here&rsquo;s the query we&rsquo;ll use to explore all records for <code>cst_id = 29466</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">sql</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">Copy</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">29466</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="explanation">Explanation:
  <a href="#explanation"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong><code>SELECT *</code></strong>: This will select all columns from the table for each row associated with <code>cst_id = 29466</code>.</li>
<li><strong><code>WHERE cst_id = 29466</code></strong>: This filters the data to include only rows where <code>cst_id</code> matches <code>29466</code>.</li>
</ul>




<h3 id="result">Result:
  <a href="#result"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>When we run the above query, the output is as follows:</p>
<table>
  <thead>
      <tr>
          <th>cst_id</th>
          <th>cst_key</th>
          <th>cst_firstname</th>
          <th>cst_lastname</th>
          <th>cst_martial_status</th>
          <th>cst_gndr</th>
          <th>cst_create_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>29466</td>
          <td>AW00029466</td>
          <td>NULL</td>
          <td>NULL</td>
          <td>NULL</td>
          <td>NULL</td>
          <td>2026-01-25</td>
      </tr>
      <tr>
          <td>29466</td>
          <td>AW00029466</td>
          <td>Lance</td>
          <td>Jimenez</td>
          <td>M</td>
          <td>NULL</td>
          <td>2026-01-26</td>
      </tr>
      <tr>
          <td>29466</td>
          <td>AW00029466</td>
          <td>Lance</td>
          <td>Jimenez</td>
          <td>M</td>
          <td>M</td>
          <td>2026-01-27</td>
      </tr>
  </tbody>
</table>




<h3 id="analysis">Analysis:
  <a href="#analysis"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Now that we have the records for <code>cst_id = 29466</code>, let‚Äôs break down what we‚Äôre seeing:</p>
<ol>
<li><strong>First Row</strong>:
<ul>
<li>The first record for <code>cst_id = 29466</code> shows a row with missing first name, last name, marital status, gender, and create date. This could indicate that the entry was initially created with minimal information.</li>
</ul>
</li>
<li><strong>Second Row</strong>:
<ul>
<li>The second record provides more complete information: <code>Lance Jimenez</code> is the first and last name, and the marital status is marked as <code>M</code> (presumably for &ldquo;Married&rdquo;). However, the gender column is still <code>NULL</code>, which may be an issue in terms of data consistency.</li>
</ul>
</li>
<li><strong>Third Row</strong>:
<ul>
<li>The third row for the same <code>cst_id</code> contains the same name but this time includes a gender value (<code>M</code> for male), indicating that some data has been updated or filled in over time.</li>
</ul>
</li>
</ol>




<h3 id="understanding-the-possible-causes-of-duplicates">Understanding the Possible Causes of Duplicates
  <a href="#understanding-the-possible-causes-of-duplicates"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>From the data, it appears that <code>cst_id = 29466</code> has multiple records with different levels of information, suggesting that this might be due to the following reasons:</p>
<ol>
<li>
<p><strong>Incomplete Data Entry</strong>:</p>
<p>The first record could have been created as an incomplete entry, with only the <code>cst_key</code> populated, leaving other fields such as name and gender as <code>NULL</code>. The subsequent records show the <code>cst_id</code> being updated with the missing data over time.</p>
</li>
<li>
<p><strong>Multiple Entries for Updates</strong>:</p>
<p>It‚Äôs also possible that the system was set up to allow multiple records for the same <code>cst_id</code> as new information was provided. This might indicate that the data entry process needs to be revisited to ensure that we don‚Äôt create multiple records for the same person unnecessarily.</p>
</li>
<li>
<p><strong>Data Correction</strong>:</p>
<p>Another possible cause is data corrections. If the customer‚Äôs information was initially incomplete or incorrect, a new entry may have been created, which is why we see a gradual filling of missing fields.</p>
</li>
</ol>




<h3 id="keeping-the-latest-record-using-row_number-window-function">Keeping the Latest Record Using <code>ROW_NUMBER()</code> Window Function
  <a href="#keeping-the-latest-record-using-row_number-window-function"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Now that we‚Äôve identified duplicate entries, let‚Äôs use the <code>ROW_NUMBER()</code> window function to easily isolate and keep the latest record for each <code>cst_id</code>.</p>
<p>The <code>ROW_NUMBER()</code> function assigns a unique number to each row within a partition of data. In our case, we partition by <code>cst_id</code> and order by <code>cst_create_date</code> in descending order, so the most recent entry for each <code>cst_id</code> will be assigned the value <code>1</code>.</p>
<p>Here‚Äôs the query to achieve that:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">sql</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">Copy</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">*</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">DESC</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>flag_last<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ranked<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>flag_last<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="explanation-1">Explanation:
  <a href="#explanation-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li>
<p><strong><code>ROW_NUMBER() OVER (PARTITION BY cst_id ORDER BY cst_create_date DESC) AS flag_last</code></strong>:</p>
<ul>
<li>The <code>ROW_NUMBER()</code> function assigns a number to each row within each <code>cst_id</code> partition.</li>
<li>The <code>PARTITION BY cst_id</code> ensures that the row numbering restarts for each unique <code>cst_id</code>.</li>
<li>The <code>ORDER BY cst_create_date DESC</code> ensures that the most recent record (the one with the latest <code>cst_create_date</code>) gets assigned the row number <code>1</code>.</li>
</ul>
</li>
<li>
<p><strong>Outer query</strong>:</p>
<p>The outer query filters out all records except those where <code>flag_last = 1</code>. This ensures that only the latest record for each <code>cst_id</code> is kept.</p>
</li>
</ul>




<h3 id="result-1">Result:
  <a href="#result-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>If you run this query, the result will show only the most recent entry for each <code>cst_id</code>:</p>
<table>
  <thead>
      <tr>
          <th>cst_id</th>
          <th>cst_key</th>
          <th>cst_firstname</th>
          <th>cst_lastname</th>
          <th>cst_martial_status</th>
          <th>cst_gndr</th>
          <th>cst_create_date</th>
          <th>flag_last</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>29466</td>
          <td>AW00029466</td>
          <td>Lance</td>
          <td>Jimenez</td>
          <td>M</td>
          <td>M</td>
          <td>2026-01-27</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>Here is the output after extracting only the last entry of each cst_id:</p>
<p><img src="Screenshot_2025-03-03_183014.png" alt="Screenshot 2025-03-03 183014.png"></p>




<h3 id="checking-for-unwanted-spaces-in-customer-data">Checking for Unwanted Spaces in Customer Data
  <a href="#checking-for-unwanted-spaces-in-customer-data"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Another common data issue we encounter is unwanted spaces in string values, such as leading or trailing spaces in names or other fields. These spaces can cause problems with data consistency, searching, and comparisons.</p>
<p>In this step, let&rsquo;s focus on how to find rows where the <code>cst_firstname</code> contains leading or trailing spaces. The SQL <code>TRIM()</code> function is used to remove these unwanted spaces. If the <code>cst_firstname</code> doesn&rsquo;t match its trimmed version, we know that there are unwanted spaces.</p>
<p>Here&rsquo;s the SQL query you can use to identify such rows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Check unwanted space for cst_firstname col
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check unwanted space for cst_lastname col
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>cst_lastname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cst_lastname<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_lastname<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check unwanted space for cst_gndr col
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="explanation-2">Explanation:
  <a href="#explanation-2"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong><code>TRIM(cst_firstname)</code></strong>: This function removes any leading and trailing spaces from the <code>cst_firstname</code> field. If the original value is not equal to the same value after trimming it means there are spaces!</li>
<li><strong><code>WHERE cst_firstname != TRIM(cst_firstname)</code></strong>: This condition checks if the original value of <code>cst_firstname</code> is different from its trimmed version, which would indicate that there are unwanted spaces.</li>
</ul>
<p>After removing the duplicates in the primary key and the unwanted spaces here is the so far sql code with the output.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff">   </span><span style="color:#57606a">-- Removed unwanted space
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_lastname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_lastname<span style="color:#fff">     </span><span style="color:#57606a">-- Removed unwanted space
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_marital_status<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span><span style="color:#1f2328">,</span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">DESC</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>flag_last<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>t<span style="color:#fff"> </span><span style="color:#cf222e">where</span><span style="color:#fff"> </span>flag_last<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="output">OUTPUT‚¨áÔ∏è
  <a href="#output"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><img src="Screenshot_2025-03-03_184050.png" alt="Screenshot 2025-03-03 184050.png"></p>




<h2 id="lets-do-quality-check"><strong>Let‚Äôs do Quality Check</strong>
  <a href="#lets-do-quality-check"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p><img src="quality_check.drawio.png" alt="quality_check.drawio.png"></p>




<h3 id="data-standardization--consistency-in-the-cst_gndr-column">Data Standardization &amp; Consistency in the <code>cst_gndr</code> Column
  <a href="#data-standardization--consistency-in-the-cst_gndr-column"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<hr>
<p>When working with customer data, it&rsquo;s crucial to ensure that the information stored in your database is clear, consistent, and meaningful. One common issue we often encounter is abbreviated terms that can lead to confusion or inconsistency, especially when dealing with gender identifiers.</p>
<p>In our data warehouse, we aim to store more readable and meaningful values instead of abbreviations like &ldquo;F&rdquo; and &ldquo;M&rdquo;. For example, instead of &ldquo;F&rdquo; representing Female and &ldquo;M&rdquo; representing Male, we will replace these values with their full terms for clarity and consistency.</p>
<p>Let‚Äôs take a look at how we can standardize the values in the <code>cst_gndr</code> column using a <code>CASE WHEN</code> statement.</p>




<h3 id="checking-existing-values-in-the-cst_gndr-column">Checking Existing Values in the <code>cst_gndr</code> Column
  <a href="#checking-existing-values-in-the-cst_gndr-column"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>First, we check the distinct values present in the <code>cst_gndr</code> column to identify how the gender data is currently stored. We can run the following query to retrieve all unique values:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="output-1">Output:
  <a href="#output-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><strong>cst_gndr</strong></p>
<hr>
<p>NULL</p>
<hr>
<p>F</p>
<hr>
<p>M</p>
<hr>
<p>From the output, we can see the following:</p>
<ul>
<li><code>NULL</code>: There are some rows where the gender information is missing.</li>
<li><code>F</code>: This is used to represent &ldquo;Female&rdquo;.</li>
<li><code>M</code>: This is used to represent &ldquo;Male&rdquo;.</li>
</ul>
<p>As noted earlier, we aim to replace these abbreviations with the full terms &ldquo;Female&rdquo; and &ldquo;Male&rdquo; to improve data clarity.</p>




<h3 id="standardizing-gender-data-with-case-when">Standardizing Gender Data with <code>CASE WHEN</code>
  <a href="#standardizing-gender-data-with-case-when"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Now, we can update the <code>cst_gndr</code> values by using the <code>CASE WHEN</code> statement to transform &ldquo;F&rdquo; into &ldquo;Female&rdquo; and &ldquo;M&rdquo; into &ldquo;Male&rdquo;. The <code>CASE WHEN</code> statement allows us to apply conditional logic directly within a query. Here&rsquo;s how we can use it to replace the abbreviated values:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_firstname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_lastname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_lastname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">CASE</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;F&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Female&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Male&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">*</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">DESC</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>flag_last<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>t<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>flag_last<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="explanation-3">Explanation:
  <a href="#explanation-3"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong><code>CASE WHEN</code></strong>: The <code>CASE WHEN</code> statement checks the value in the <code>cst_gndr</code> column:
<ul>
<li>If <code>cst_gndr = 'F'</code>, it returns &ldquo;Female&rdquo;.</li>
<li>If <code>cst_gndr = 'M'</code>, it returns &ldquo;Male&rdquo;.</li>
<li>The <code>ELSE</code> part ensures that if the value is neither &ldquo;F&rdquo; nor &ldquo;M&rdquo; (like <code>NULL</code>), it remains unchanged.</li>
</ul>
</li>
<li><strong><code>ROW_NUMBER() OVER (PARTITION BY cst_id ORDER BY cst_create_date DESC)</code></strong>: As discussed in a previous step, the <code>ROW_NUMBER()</code> function helps us to find the most recent record for each <code>cst_id</code>. This ensures that we only keep the latest entry for each customer.</li>
<li><strong><code>TRIM(cst_firstname)</code> and <code>TRIM(cst_lastname)</code></strong>: We‚Äôre using the <code>TRIM()</code> function to ensure that any leading or trailing spaces in the <code>cst_firstname</code> and <code>cst_lastname</code> columns are removed, further improving data consistency.</li>
<li><strong><code>WHERE flag_last = 1</code></strong>: This condition filters the results to only include the most recent record for each customer (based on <code>cst_create_date</code>).</li>
</ul>




<h3 id="result-after-fixing">Result after fixing
  <a href="#result-after-fixing"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Once you execute the query, the <code>cst_gndr</code> column will show &ldquo;Female&rdquo; instead of &ldquo;F&rdquo; and &ldquo;Male&rdquo; instead of &ldquo;M&rdquo;. The output will look something like this:</p>
<table>
  <thead>
      <tr>
          <th>cst_id</th>
          <th>cst_key</th>
          <th>cst_firstname</th>
          <th>cst_lastname</th>
          <th>cst_marital_status</th>
          <th>cst_gndr</th>
          <th>cst_create_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>29466</td>
          <td>AW00029466</td>
          <td>Lance</td>
          <td>Jimenez</td>
          <td>M</td>
          <td>Male</td>
          <td>2026-01-27</td>
      </tr>
  </tbody>
</table>
<p>As you can see, &ldquo;M&rdquo; is now replaced with &ldquo;Male&rdquo; for better clarity, and &ldquo;F&rdquo; would be similarly replaced with &ldquo;Female&rdquo; in the rows where applicable.</p>
<hr>




<h3 id="further-enhancing-data-standardization-with-upper-and-trim">Further Enhancing Data Standardization with <code>UPPER()</code> and <code>TRIM()</code>
  <a href="#further-enhancing-data-standardization-with-upper-and-trim"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>To ensure consistency in the <code>cst_gndr</code> column, we can further enhance the <code>CASE WHEN</code> logic by using the <code>UPPER()</code> and <code>TRIM()</code> functions. The <code>UPPER()</code> function makes the comparison case-insensitive, and <code>TRIM()</code> removes any leading or trailing spaces, ensuring that all values are standardized.</p>
<p>Here‚Äôs the updated SQL query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_firstname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_lastname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_lastname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">CASE</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;F&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Female&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Male&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">*</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">DESC</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>flag_last<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>t<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>flag_last<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p>This ensures that &ldquo;f&rdquo;, &quot; F&quot;, or &ldquo;M&rdquo; are all treated as &ldquo;Female&rdquo; and &ldquo;Male&rdquo;, respectively, and any extra spaces are removed. If there are any unexpected values, we default them to &ldquo;n/a&rdquo;.</p>
<hr>
<p>Just like we standardized the <code>cst_gndr</code> column, we can also clean up the <code>cst_marital_status</code> column. We have three distinct values in the data:</p>
<ul>
<li><code>NULL</code> (indicating missing data),</li>
<li><code>S</code> (representing &ldquo;Single&rdquo;),</li>
<li><code>M</code> (representing &ldquo;Married&rdquo;).</li>
</ul>
<p>We will use a <code>CASE WHEN</code> statement along with the <code>UPPER()</code> and <code>TRIM()</code> functions to standardize these values into more meaningful terms.</p>




<h3 id="updated-sql-query">Updated SQL Query:
  <a href="#updated-sql-query"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_lastname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_lastname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_marital_status<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;S&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Single&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_marital_status<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Married&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_marital_status<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;F&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Female&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Male&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span><span style="color:#1f2328">,</span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">DESC</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>flag_last<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>t<span style="color:#fff"> </span><span style="color:#cf222e">where</span><span style="color:#fff"> </span>flag_last<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="explanation-4">Explanation:
  <a href="#explanation-4"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong><code>UPPER(TRIM(cst_marital_status))</code></strong>: This ensures that the <code>cst_marital_status</code> field is case-insensitive and that any extra spaces are removed.</li>
<li><strong><code>CASE WHEN</code></strong>:
<ul>
<li>Converts &ldquo;S&rdquo; to &ldquo;Single&rdquo;.</li>
<li>Converts &ldquo;M&rdquo; to &ldquo;Married&rdquo;.</li>
<li>Any other value (including <code>NULL</code> or unexpected entries) is replaced with &ldquo;n/a&rdquo;.</li>
</ul>
</li>
</ul>
<hr>
<hr>




<h3 id="inserting-cleaned-data-into-the-silver-layer">Inserting Cleaned Data into the Silver Layer
  <a href="#inserting-cleaned-data-into-the-silver-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>After standardizing and cleaning the data in the bronze layer, the next step is to move the cleaned data into the silver layer. The silver layer typically represents data that is cleaned, transformed, and ready for analysis or further processing.</p>
<p>In this case, we have applied various transformations to the <code>cst_gndr</code> and <code>cst_marital_status</code> columns, ensuring that gender and marital status values are consistent and clear. Now, it‚Äôs time to insert the updated data into the silver layer.</p>




<h3 id="sql-query-to-insert-cleaned-data-into-the-silver-layer">SQL Query to Insert Cleaned Data into the Silver Layer
  <a href="#sql-query-to-insert-cleaned-data-into-the-silver-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">INSERT</span><span style="color:#fff"> </span><span style="color:#cf222e">INTO</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_firstname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_lastname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_lastname<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_lastname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_marital_status<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;S&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Single&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_marital_status<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Married&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_marital_status<span style="color:#fff">  </span><span style="color:#57606a">-- Normalize martial status values to readable format
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;F&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Female&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_gndr<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Male&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff">  </span><span style="color:#57606a">-- Normalize gender values to readable format
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cst_create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span><span style="color:#1f2328">,</span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">DESC</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>flag_last<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>t<span style="color:#fff"> </span><span style="color:#cf222e">where</span><span style="color:#fff"> </span>flag_last<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">;</span><span style="color:#fff">  </span><span style="color:#57606a">-- Select the most recent record per customer
</span></span></span></code></pre></div>



<h3 id="explanation-5">Explanation:
  <a href="#explanation-5"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ol>
<li><strong>Target Table</strong>: We are inserting the cleaned data into the <code>silver.crm_cust_info</code> table. This table should already exist in your data warehouse, and it typically holds data that has been cleaned and transformed, ready for further analytics.</li>
<li><strong>Columns</strong>: The columns being inserted are:
<ul>
<li><code>cst_id</code>: The customer ID.</li>
<li><code>cst_key</code>: The customer key.</li>
<li><code>cst_firstname</code>: The cleaned first name with leading/trailing spaces removed.</li>
<li><code>cst_lastname</code>: The cleaned last name with leading/trailing spaces removed.</li>
<li><code>cst_marital_status</code>: The standardized marital status (&ldquo;Single&rdquo; or &ldquo;Married&rdquo;).</li>
<li><code>cst_gndr</code>: The standardized gender (&ldquo;Female&rdquo; or &ldquo;Male&rdquo;).</li>
<li><code>cst_create_date</code>: The customer creation date.</li>
</ul>
</li>
<li><strong>Data Selection</strong>: The data is selected from the <code>bronze.crm_cust_info</code> table where we have already applied the necessary transformations, including:
<ul>
<li><strong><code>TRIM()</code></strong> for removing leading/trailing spaces in <code>cst_firstname</code> and <code>cst_lastname</code>.</li>
<li><strong><code>UPPER()</code> and <code>TRIM()</code></strong> in the <code>CASE WHEN</code> statements for the <code>cst_marital_status</code> and <code>cst_gndr</code> columns, ensuring that all values are consistent and standardized.</li>
<li><strong><code>ROW_NUMBER()</code></strong> is used in the previous queries to ensure only the most recent records for each customer are selected (<code>flag_last = 1</code>).</li>
</ul>
</li>
<li><strong>Purpose of the Insert</strong>: This <code>INSERT</code> operation populates the silver layer with the cleaned data, ensuring that the data is now ready for downstream processes such as reporting, business intelligence, or analytics.</li>
</ol>




<h3 id="why-inserting-into-the-silver-layer-is-important">Why Inserting into the Silver Layer is Important
  <a href="#why-inserting-into-the-silver-layer-is-important"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>Data Transformation</strong>: The silver layer typically stores transformed and cleaned data. It‚Äôs a bridge between raw data (bronze layer) and final analytical datasets (gold layer). In our case, by inserting the cleaned data into the silver layer, we ensure it‚Äôs ready for consumption by analysts and data scientists.</li>
<li><strong>Improved Data Quality</strong>: By inserting standardized data, we ensure consistency across all systems, making it easier to trust and use for decision-making. For example, standardized gender and marital status values make it easier to group and analyze customer data.</li>
<li><strong>Ready for Analysis</strong>: The silver layer is typically optimized for analytical workloads. The cleaned and standardized data in the silver layer can now be used for various analysis, reporting, and business decision-making.</li>
</ul>




<h3 id="conclusion-moving-cleaned-data-to-the-silver-layer">Conclusion: Moving Cleaned Data to the Silver Layer
  <a href="#conclusion-moving-cleaned-data-to-the-silver-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>By inserting the cleaned and standardized data from the bronze layer into the silver layer, we ensure that the data is ready for more complex analyses and reporting. The silver layer serves as an essential middle ground for transforming raw data into meaningful insights, improving data quality, and streamlining the entire data pipeline.</p>
<hr>




<h3 id="final-data-quality-checks-in-the-silver-layer">Final Data Quality Checks in the Silver Layer
  <a href="#final-data-quality-checks-in-the-silver-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>After inserting the cleaned and standardized data into the silver layer, it&rsquo;s crucial to perform final data quality checks. This ensures that the data is free from duplicates, unwanted spaces, and maintains overall consistency. These checks ensure that the data in the silver layer is of the highest quality before it is used for reporting, analysis, or decision-making.</p>




<h3 id="checking-for-duplicate-primary-keys">Checking for Duplicate Primary Keys
  <a href="#checking-for-duplicate-primary-keys"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>One of the first checks to perform is to ensure there are no duplicates in the primary key, which could result from multiple records being inserted. In our case, the primary key is the <code>cst_id</code>. Duplicate primary keys can lead to data integrity issues, so it‚Äôs important to confirm that each customer has only one unique record.</p>
<p>Here‚Äôs how we can check for duplicates in the <code>cst_id</code> column:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>no_of_counts<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p>If this query returns any results, it indicates that there are duplicate <code>cst_id</code> values in the table. In this case, we need to resolve the duplicates by identifying the most recent or valid record for each customer.</p>




<h3 id="132-checking-for-unwanted-spaces">13.2: Checking for Unwanted Spaces
  <a href="#132-checking-for-unwanted-spaces"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Next, we need to ensure that there are no unwanted spaces in key columns like <code>cst_firstname</code> and <code>cst_lastname</code>. Leading or trailing spaces can cause issues in analysis and reporting, so we should check for any instances where the names contain extra spaces.</p>
<p>Here‚Äôs how to check for unwanted spaces in the <code>cst_firstname</code> column:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cst_firstname<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_firstname<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><p>If any results are returned, we can further clean the data by removing those unwanted spaces.</p>




<h3 id="ensuring-data-standardization--consistency">Ensuring Data Standardization &amp; Consistency
  <a href="#ensuring-data-standardization--consistency"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Finally, we can recheck the data for consistency and standardization. This includes verifying that the gender and marital status values are consistent across the entire dataset. For instance, we can ensure that the <code>cst_gndr</code> column contains only &ldquo;Male&rdquo; or &ldquo;Female&rdquo; and that <code>cst_marital_status</code> is correctly labeled as &ldquo;Single&rdquo; or &ldquo;Married&rdquo; (or &ldquo;n/a&rdquo; for invalid entries).</p>
<p>Here‚Äôs a simple query to check the distinct values in the <code>cst_gndr</code> and <code>cst_marital_status</code> columns:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p>This will show the distinct values in the <code>cst_gndr</code> column to ensure that only &ldquo;Male&rdquo; and &ldquo;Female&rdquo; are present, along with any &ldquo;n/a&rdquo; values. Similarly, we can do the same for the <code>cst_marital_status</code> column.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>cst_marital_status<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="conclusion-final-data-quality-assurance">Conclusion: Final Data Quality Assurance
  <a href="#conclusion-final-data-quality-assurance"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Performing these final data quality checks in the silver layer ensures that the data is clean, consistent, and ready for advanced analysis. By checking for duplicates, unwanted spaces, and verifying data standardization, we can confidently move forward with using this data for reporting, analytics, or any other downstream processes.</p>
<p>These checks are essential for maintaining the integrity of your data warehouse and ensuring that the data being used for decision-making is of the highest quality.</p>
<hr>




<h2 id="what-we-have-done-so-far"><strong>What we have done so far.</strong>
  <a href="#what-we-have-done-so-far"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p><img src="clean_data.drawio.png" alt="clean_data.drawio.png"></p>
<hr>




<h1 id="build-silver-layer-clean--load-crm_prd_info">Build Silver Layer Clean &amp; Load crm_prd_info
  <a href="#build-silver-layer-clean--load-crm_prd_info"></a>
</h1>
<p>Here is the top 10 values from the crm_prd_info table</p>
<p><img src="Screenshot_2025-03-03_193840.png" alt="Screenshot 2025-03-03 193840.png"></p>
<p>Let‚Äôs check first for Nulls or Duplicates in the <strong>prd_id</strong> key (Primary Key) using following script</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>prd_id<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p>After verifying that there are no duplicates in the <strong><code>prd_id</code></strong> column, we now move on to the <strong><code>prd_key</code></strong> column. We‚Äôve identified that <strong><code>prd_key</code></strong> contains multiple pieces of information that need to be extracted separately for better clarity and usability. To achieve this, we can use the <code>SUBSTRING()</code> function to extract specific parts of the string in the <strong><code>prd_key</code></strong> colum</p>




<h3 id="using-substring-function">Using <code>SUBSTRING()</code> Function
  <a href="#using-substring-function"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The <code>SUBSTRING()</code> function allows us to extract a specific portion of a string. It takes three arguments:</p>
<ol>
<li><strong>Argument 1</strong>: The column name (in this case, <strong><code>prd_key</code></strong>) that we want to extract data from.</li>
<li><strong>Argument 2</strong>: The starting position (from where to begin extracting).</li>
<li><strong>Argument 3</strong>: The length (how many characters you want to extract).</li>
</ol>




<h3 id="example">Example:
  <a href="#example"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Let‚Äôs say you want to extract the first 5 characters from the <strong><code>prd_key</code></strong> column:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>extracted_part<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prod_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><ul>
<li><strong><code>prd_key</code></strong>: The column that contains the string.</li>
<li><strong><code>1</code></strong>: The starting position, which is the 1st character of the string.</li>
<li><strong><code>5</code></strong>: The number of characters to extract, so it will get the first 5 characters.</li>
</ul>
<p>If <strong><code>prd_key</code></strong> contains a value like <code>CO-RF-FR-R92B-58</code>, the result of this query would be <code>CO-RF</code>.</p>
<p>So, let‚Äôs add the new column into our database</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div><p>As part of our data processing, we need to merge data from our <strong><code>silver.crm_prod_info</code></strong> table with another table called <strong><code>erp_px_cat_g1v2</code></strong>. This table contains an ID column called <strong><code>CO_RF</code></strong> that we intend to join with the <strong><code>prd_key</code></strong> column in our table. However, there is a key difference between the two columns that could prevent a successful join.</p>
<ul>
<li><strong>In our table</strong>: The <strong><code>prd_key</code></strong> column contains values like <code>CO-RF</code> where the delimiter between parts of the string is a hyphen (``).</li>
<li><strong>In the <code>erp_px_cat_g1v2</code> table</strong>: The <strong><code>CO_RF</code></strong> column contains values like <code>CO_RF</code>, where the delimiter is an underscore (<code>_</code>).</li>
</ul>
<p>This difference in formatting (hyphen vs underscore) would cause issues when trying to join the two tables, as the join condition would not match. Therefore, to ensure we can correctly merge the tables, we need to standardize the format of the <strong><code>prd_key</code></strong> column by replacing the hyphen (<code>-</code>) with an underscore (<code>_</code>).</p>




<h3 id="using-the-replace-function-to-change-hyphen-to-underscore">Using the <code>REPLACE()</code> Function to Change Hyphen to Underscore
  <a href="#using-the-replace-function-to-change-hyphen-to-underscore"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>To perform this transformation, we use the <code>REPLACE()</code> function. This function allows us to search for a specific substring (in this case, the hyphen <code>-</code>) and replace it with another substring (the underscore <code>_</code>), ensuring the two columns are now compatible for joining.</p>




<h3 id="sql-query-to-replace-hyphen-with-underscore">SQL Query to Replace Hyphen with Underscore
  <a href="#sql-query-to-replace-hyphen-with-underscore"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">),</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;_&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div><p>So far our table look like below where we an see our new column <strong>cat_id</strong> has been added correctly.</p>
<p><img src="Screenshot_2025-03-03_195445.png" alt="Screenshot 2025-03-03 195445.png"></p>
<p>In addition to formatting the <strong><code>prd_key</code></strong> column to ensure it correctly joins with the <strong><code>erp_px_cat_g1v2</code></strong> table, we also need to join the <strong><code>prd_key</code></strong> with the <strong><code>sls_prd_key</code></strong> column in the <strong><code>crm_sales_details</code></strong> table. The <strong><code>prd_key</code></strong> in our table contains extra characters that we do not need for this join. Specifically, we need to extract a part of the <strong><code>prd_key</code></strong> to match the <strong><code>sls_prd_key</code></strong>.</p>
<p>To achieve this, we can use the <code>SUBSTRING()</code> function, which allows us to extract a portion o the string from the <strong><code>prd_key</code></strong>.</p>




<h3 id="why-we-need-to-extract-the-prd_key">Why We Need to Extract the <code>prd_key</code>
  <a href="#why-we-need-to-extract-the-prd_key"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The <strong><code>prd_key</code></strong> in our table may include extra characters, such as prefixes or additional information, that are irrelevant for the join with <strong><code>sls_prd_key</code></strong> in the <strong><code>crm_sales_details</code></strong> table. The <strong><code>sls_prd_key</code></strong> column likely contains a subset of the <strong><code>prd_key</code></strong> information, starting from the 7th character onward.</p>




<h3 id="using-the-substring-function-to-extract-the-key">Using the <code>SUBSTRING()</code> Function to Extract the Key
  <a href="#using-the-substring-function-to-extract-the-key"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The <code>SUBSTRING()</code> function allows us to specify the starting position and the length of the substring to be extracted. In this case, we want to start extracting from the 7th character of the <strong><code>prd_key</code></strong> and include all characters from that point onward.</p>
<p>Here‚Äôs how we can extract the relevant portion of the <strong><code>prd_key</code></strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">),</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;_&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#0550ae">7</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="explanation-6">Explanation:
  <a href="#explanation-6"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong><code>prd_key</code></strong>: This is the column containing the full product key.</li>
<li><strong><code>7</code></strong>: This specifies the starting position (the 7th character of the <strong><code>prd_key</code></strong>). We&rsquo;re ignoring the first 6 characters, as they are not needed for the join.</li>
<li><strong><code>LEN(prd_key)</code></strong>: This specifies the length of the string to extract. By using <code>LEN(prd_key)</code>, we ensure that we extract all remaining characters from the 7th position to the end of the string.</li>
</ul>
<p>This query extracts the portion of the <strong><code>prd_key</code></strong> starting from the 7th character until the end, which matches the format of the <strong><code>sls_prd_key</code></strong> column in the <strong><code>crm_sales_details</code></strong> table.</p>
<hr>
<p>Now, let‚Äôs move on to the next column which is <strong>prd_nm</strong> (product name)</p>
<p>First check the unwanted spaces I have checked there is not unwanted space</p>
<p>Let‚Äô, check for NULLs or Negative Numbers in the <strong>prd_cost</strong> columns</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="we-can-see-we-dont-have-negative-values-but-we-do-have-nulls-which-we-need-to-handle-that">|we can see we don‚Äôt have negative values but we do have NULLs which we need to handle that
  <a href="#we-can-see-we-dont-have-negative-values-but-we-do-have-nulls-which-we-need-to-handle-that"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Using ISNULL() we can replace null ‚Äî&gt; 0</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">),</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;_&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#0550ae">7</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">ISNULL</span><span style="color:#1f2328">(</span>prd_cost<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff"> </span><span style="color:#57606a">-- Here we have used isnull to replace the NULLs value with 0
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div><hr>
<p>Now Let‚Äôs see the prd_line colunm</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-03_201051.png" alt="Screenshot 2025-03-03 201051.png"></p>
<p>Note: We have to replace the above distinct value with the full name for  better data standardization.</p>
<p>So to do that we are going to use CASE WHEN</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Quick CASE WHEN ideal for simple value mapping
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>prd_line<span style="color:#1f2328">))</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Mountain&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;R&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Road&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;S&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Other Sales&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;T&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Touring&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_line<span style="color:#fff">
</span></span></span></code></pre></div><p>Here is the full code so far we gave</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">),</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;_&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#0550ae">7</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">ISNULL</span><span style="color:#1f2328">(</span>prd_cost<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>prd_line<span style="color:#1f2328">))</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Mountain&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;R&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Road&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;S&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Other Sales&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;T&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Touring&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div><hr>
<p>Now let‚Äôs got to the last columns prd_start_dt &amp; prd_end_dt</p>
<p>Let‚Äôs check for Invalid Date Orders our hypothesis is <strong>End date must not be earlier than the start date</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Check for invalid date Orders
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p>Here is the output:</p>
<p><img src="Screenshot_2025-03-03_213504.png" alt="Screenshot 2025-03-03 213504.png"></p>
<p>Observation:</p>
<blockquote>
<p>In our table the prd_start_dt is always greater then prd_end_dt which is incorrect/not making sense at all.</p></blockquote>
<p>How we can tackle this issue?ü§î</p>
<blockquote>
<p>For complex transformations in SQL, I typically narrow it down to a specific example and brainstorm multiple solution approaches.</p></blockquote>
<p>Solutions:</p>
<ol>
<li>
<p>Switch End Date and Start Date ‚Äî&gt;</p>
<p><img src="Screenshot_2025-03-03_215219.png" alt="Screenshot 2025-03-03 215219.png"></p>
<p><strong>Note</strong>: Issue with this approach is the dates are overlapping and it is not making any sense, the prices are not acceptable</p>
<p>=‚áí Above you can see in the approach testing table the <strong>start_dt</strong> is <strong>2007</strong> and the <strong>end_dt</strong> is  <strong>2011</strong> the price is <strong>12</strong> but in next row the <strong>start_dt</strong> is <strong>2008</strong> and <strong>end_dt</strong> is <strong>2012</strong> the price was <strong>14</strong> which is not correct because if you take <strong>2010</strong> year it was <strong>12</strong> at the same time <strong>14</strong>  so it is bed to have overlapping between years. <em><strong>Each Record must has a Start Date !!</strong></em></p>
</li>
<li>
<p>Derive the End Date from the Start Date ‚Äî&gt; <strong>END DATE = Start Date of the NEXT Record - 1</strong></p>
<p><img src="Screenshot_2025-03-03_220321.png" alt="Screenshot 2025-03-03 220321.png"></p>
</li>
</ol>
<p>So, Here we will go with the 2nd solution in order to resolve the issue.</p>
<p>It‚Äôs always the best practice to see into the ID or row with the issue is occurring in order to building the logic like in above situation let‚Äôs take look into two prd_key</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;AC-HE-HL-U509-R&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;AC-HE-HL-U509&#39;</span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><p>here is the output:</p>
<p><img src="Screenshot_2025-03-03_221434.png" alt="Screenshot 2025-03-03 221434.png"></p>
<p>So, our logic is we want to next record prd_start_dt to be the prd_end_dt - 1 we will use it Window function which in this case LEAD ()</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>prd_start_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>prd_end_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>LEAD<span style="color:#1f2328">(</span>prd_start_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#1f2328">)</span><span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_end_dt_test<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;AC-HE-HL-U509-R&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;AC-HE-HL-U509&#39;</span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-03_222922.png" alt="Screenshot 2025-03-03 222922.png"></p>
<p>Let‚Äôs add this code into our main code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">),</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;_&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#0550ae">7</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">ISNULL</span><span style="color:#1f2328">(</span>prd_cost<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>prd_line<span style="color:#1f2328">))</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Mountain&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;R&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Road&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;S&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Other Sales&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;T&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Touring&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>prd_start_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>LEAD<span style="color:#1f2328">(</span>prd_start_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#1f2328">)</span><span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span></code></pre></div><p>Now as we changed the prd_start_dt &amp; prd_end_dt into DATE format and also added the new cat_id column so we have to re create our silver.crm_prd_info TABLE.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">IF</span><span style="color:#fff"> </span>OBJECT_ID<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;silver.crm_prd_info&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;U&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">DROP</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">TABLE</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_id<span style="color:#fff">			</span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cat_id<span style="color:#fff">			</span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">  </span><span style="color:#57606a">-- This one we have added
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span>prd_key<span style="color:#fff">			</span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_nm<span style="color:#fff">			</span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_cost<span style="color:#fff">		</span><span style="color:#6639ba">INT</span><span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_line<span style="color:#fff">		</span>NVARCHAR<span style="color:#1f2328">(</span><span style="color:#0550ae">50</span><span style="color:#1f2328">),</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_start_dt<span style="color:#fff">	</span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">,</span><span style="color:#fff">  </span><span style="color:#57606a">-- CAST DATETIME to DATE
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span>prd_end_dt<span style="color:#fff">		</span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">,</span><span style="color:#fff">  </span><span style="color:#57606a">-- CAST DATETIME to DATE
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span>dwh_create_date<span style="color:#fff"> </span>DATETIME2<span style="color:#fff"> </span><span style="color:#cf222e">DEFAULT</span><span style="color:#fff"> </span>GETDATE<span style="color:#1f2328">()</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><p>Let‚Äôs Insert the clean crm_prd_info table into our silver layer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">INSERT</span><span style="color:#fff"> </span><span style="color:#cf222e">INTO</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cat_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_nm<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_cost<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_line<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_start_dt<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>prd_end_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">5</span><span style="color:#1f2328">),</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;_&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cat_id<span style="color:#fff">  </span><span style="color:#57606a">-- Extract category ID
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">,</span><span style="color:#0550ae">7</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>prd_key<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_key<span style="color:#fff">          </span><span style="color:#57606a">-- Extract product key
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">ISNULL</span><span style="color:#1f2328">(</span>prd_cost<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>prd_line<span style="color:#1f2328">))</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Mountain&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;R&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Road&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;S&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Other Sales&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;T&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Touring&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_line<span style="color:#fff">  </span><span style="color:#57606a">-- Map product line codes to descriptive values
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>prd_start_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>LEAD<span style="color:#1f2328">(</span>prd_start_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span>PARTITION<span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#1f2328">)</span><span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff">  </span><span style="color:#57606a">-- Calculate end date as one day before the next start date.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><hr>




<h2 id="build-silver-layer-clean--load-crm_sales_details">Build Silver Layer Clean &amp; Load crm_sales_details
  <a href="#build-silver-layer-clean--load-crm_sales_details"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Let‚Äôs first see the table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_175952.png" alt="Screenshot 2025-03-04 175952.png"></p>
<p>Let‚Äôs take first column sls_ord_num check for unwanted spaces</p>
<p>Now move one to sls_prd_key &amp; sls_cust_id columns So here these column we will need to connect with <strong>crm_prd_info</strong> through <strong>prd_key</strong> and <strong>crm_cust_info</strong> table with cst_id</p>
<p>So, we need to check by writing</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_prd_key<span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for crm_cust_info table
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_cust_id<span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>cust_id<span style="color:#fff"> </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span></code></pre></div><p>So, first three columns are perfect the next three date columns are not in date format.</p>
<p>Here we have to convert the date from Integer ‚Äî&gt; Date (<em>Note: Negative numbers or zeros can‚Äôt be cast to a date</em>)</p>
<p>We can check by writing below script</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Check for Invalid Dates
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_181028.png" alt="Screenshot 2025-03-04 181028.png"></p>
<p>We can see we do have total 17 rows where where 0 are there which is not good but we can handle this issue by using <strong>NULLIF( )</strong> function</p>
<p>NULLIF() ‚Äî&gt; Return NULL if two given values are equal; otherwise, it returns the first expression.</p>
<p>Here is the code to convert 0 value to NULL</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">NULLIF</span><span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">,</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span></code></pre></div><p>Now let‚Äôs see the value</p>
<p><img src="Screenshot_2025-03-04_181355.png" alt="Screenshot 2025-03-04 181355.png"></p>
<p>We can see the value are in integer format which we have to convert it to date format</p>
<p><img src="Screenshot_2025-03-04_182227.png" alt="Screenshot 2025-03-04 182227.png"></p>
<p>In this scenario, the length of the date must be 8 more then length 8 is not a valid value let‚Äôs check</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">NULLIF</span><span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">,</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_182914.png" alt="Screenshot 2025-03-04 182914.png"></p>
<p>Check for outliers by validating the boundaries of the date range</p>
<p>Here are all checks that I have checked</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">NULLIF</span><span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">,</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff">  </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">20500101</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span><span style="color:#0550ae">19000101</span><span style="color:#fff">
</span></span></span></code></pre></div><p>So, below are the steps we need to follow</p>
<ol>
<li>Convert all 0 or the value which not equal to 8 to NULL</li>
<li>Typecasting Integer ‚Äî‚Äî&gt; Date format but in SQL we can‚Äôt cast Integer ‚Äî&gt; Date first we have to convert integer ‚Äî&gt; varchar ‚Äî&gt; Date</li>
</ol>
<p>Here is the script</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	    </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_order_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	     </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_184728.png" alt="Screenshot 2025-03-04 184728.png"></p>
<p>As you can see our sls_order_dt data which was integer type has been converted to date format</p>
<p>Similarly we can convert sls_ship_dt &amp; sls_due_dt  value to Date format</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	    </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_order_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	     </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_ship_dt<span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_ship_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_ship_dtAS<span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	     </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_due_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_due_dtAS<span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	     </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span></code></pre></div><p>Now let‚Äôs think deeper with the date related columns like <strong>Order Date must always be earlier than the shipping Data or Due Date</strong></p>
<p>Let‚Äôs check whether order_dt &gt; ship_dt OR order_dt &gt; due_dt</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>sls_ship_dt<span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_215505.png" alt="Screenshot 2025-03-04 215505.png"></p>




<h2 id="check-data-consistency-between-sales-quantity--price">Check Data Consistency: Between Sales, Quantity, &amp; Price
  <a href="#check-data-consistency-between-sales-quantity--price"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<ul>
<li>Sales = Quantity * Price</li>
<li>Values must not be NULL, Zero or Negative</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>sls_sales<span style="color:#1f2328">,</span><span style="color:#fff"> </span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_220457.png" alt="Screenshot 2025-03-04 220457.png"></p>
<p>Above we can see in our database the sls_sales have NULL values and also the negative value and the Sales value is not correct because sales should come by multiply Quantity * Price</p>
<p>Solutions:</p>
<ol>
<li>Data Issues will be fixed direct in source system</li>
<li>Data issues has to be fixed in data warehouse</li>
</ol>
<p>Rules:</p>
<ul>
<li>If Sales is negative, zero, or null, derive it using Quantity and Price.</li>
<li>If Price is zero or null, calculate it using Sales &amp; Quantity.</li>
<li>If Price is negative, convert it to a positive value.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>old_sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>old_sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">ABS</span><span style="color:#1f2328">(</span>sls_price<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">ABS</span><span style="color:#1f2328">(</span>sls_price<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>new_sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">/</span><span style="color:#fff"> </span><span style="color:#cf222e">NULLIF</span><span style="color:#1f2328">(</span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>new_sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>sls_sales<span style="color:#1f2328">,</span><span style="color:#fff"> </span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#fff"> </span>sls_price<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_222106.png" alt="Screenshot 2025-03-04 222106.png"></p>
<p>We have done with cleaning the sales_data now we have to modify our column data types and insert into silver layer</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">INSERT</span><span style="color:#fff"> </span><span style="color:#cf222e">INTO</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_ord_num<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_prd_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_cust_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_order_dt<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_ship_dt<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_due_dt<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_sales<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#1f2328">,</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	  </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_order_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			</span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_order_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	   </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	  </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_ship_dt<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_ship_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			</span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_ship_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	   </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	  </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_due_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">			</span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span><span style="color:#cf222e">CAST</span><span style="color:#1f2328">(</span>sls_due_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">VARCHAR</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span><span style="color:#6639ba">DATE</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	   </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	  </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">ABS</span><span style="color:#1f2328">(</span>sls_price<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">ABS</span><span style="color:#1f2328">(</span>sls_price<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	   </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	  </span><span style="color:#1f2328">,</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	  </span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">/</span><span style="color:#fff"> </span><span style="color:#cf222e">NULLIF</span><span style="color:#1f2328">(</span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	   </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span></code></pre></div><p>Now let‚Äôs see our final table which we have insert into silver.crm_sales_details</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="before-data-cleansing">Before Data Cleansing
  <a href="#before-data-cleansing"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><img src="Screenshot_2025-03-04_224006.png" alt="Screenshot 2025-03-04 224006.png"></p>




<h3 id="after-data-cleansing">After Data Cleansing
  <a href="#after-data-cleansing"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><img src="Screenshot_2025-03-04_223833.png" alt="Screenshot 2025-03-04 223833.png"></p>
<hr>
<hr>




<h1 id="build-silver-layer-clean--load-erp_cust_az12">Build Silver Layer Clean &amp; Load erp_cust_az12
  <a href="#build-silver-layer-clean--load-erp_cust_az12"></a>
</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>bdate<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-04_230457.png" alt="Screenshot 2025-03-04 230457.png"></p>
<p><img src="Screenshot_2025-03-04_231340.png" alt="Screenshot 2025-03-04 231340.png"></p>
<p>Here to remove ‚ÄòNAS‚Äô from the starting to keep the ‚ÄòAW00011000‚Äô we can use LIKE function.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>cid<span style="color:#fff"> </span><span style="color:#cf222e">LIKE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;NAS%&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#0550ae">4</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>cid<span style="color:#1f2328">))</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>bdate<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span></code></pre></div><p>Now we can check whether there are any unmatched ID is there in crm_cust_info table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>cid<span style="color:#fff"> </span><span style="color:#cf222e">LIKE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;NAS%&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#0550ae">4</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>cid<span style="color:#1f2328">))</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>bdate<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>cid<span style="color:#fff"> </span><span style="color:#cf222e">LIKE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;NAS%&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#0550ae">4</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>cid<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>cst_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span></code></pre></div><p>After checking we can see we don‚Äôt have any unmatched cst_key which is a good sign</p>
<p>Now we can also check that the birthday should don‚Äôt have dob in future years like 9999 which hasn‚Äôt come yet.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Identify Out-of-Range Dates
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>bdate<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>bdate<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;1924-01-01&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>bdate<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>GETDATE<span style="color:#1f2328">()</span><span style="color:#fff">
</span></span></span></code></pre></div><p>Let‚Äôs also check Standardization &amp; Consistency of gen column</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">OUTPUT</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">2</span><span style="color:#fff"> </span>F<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">3</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">4</span><span style="color:#fff"> </span>Male<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">5</span><span style="color:#fff"> </span>Female<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">6</span><span style="color:#fff"> </span>M<span style="color:#fff">
</span></span></span></code></pre></div><p>Above out we can we our <strong>gen</strong> values are not in multiple option like we have <strong>NULL, F, Male, Female, M, space</strong></p>
<p>So, we need to use CASE WHEN with TRIM() so whenever there will be (‚ÄôF‚Äô or ‚ÄòFemale‚Äô) make it ‚ÄòFamale‚Äô and same for ‚ÄòMale‚Äô</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>gen<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;F&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;FEMALE&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Female&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>gen<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;MALE&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Male&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span></code></pre></div><p>Old gen_table     ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî&gt;</p>




<h3 id="gen">gen
  <a href="#gen"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>NULL</p>
<p>F</p>
<p>Male</p>
<p>Female</p>
<p>M</p>
<p>New gen_table after standardization</p>




<h3 id="gen-1">gen
  <a href="#gen-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>n/a</p>
<p>Female</p>
<p>n/a</p>
<p>Male</p>
<p>Female</p>
<p>Male</p>
<p>Now we have finished cleaning the erp_cust_az12 table now let‚Äôs insert into silver layer</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">INSERT</span><span style="color:#fff"> </span><span style="color:#cf222e">INTO</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cid<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>bdate<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>cid<span style="color:#fff"> </span><span style="color:#cf222e">LIKE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;NAS%&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">SUBSTRING</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#0550ae">4</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>cid<span style="color:#1f2328">))</span><span style="color:#fff">    </span><span style="color:#57606a">-- Remove &#39;NAS&#39; prefix if present
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	      </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>bdate<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>GETDATE<span style="color:#1f2328">()</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>bdate<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>bdate<span style="color:#fff">  </span><span style="color:#57606a">-- Set future birthdates to NULL
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>gen<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;F&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;FEMALE&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Female&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">UPPER</span><span style="color:#1f2328">(</span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>gen<span style="color:#1f2328">))</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;M&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;MALE&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Male&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">  </span><span style="color:#57606a">-- Handle the missing values
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>gen<span style="color:#fff">  </span><span style="color:#57606a">-- Normalize gender values and handle unknown cases
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p>Also do the Quality Check of the Silver Table</p>
<hr>




<h1 id="build-silver-layer-clean--load-erp_loc_a101">Build Silver Layer Clean &amp; Load erp_loc_a101
  <a href="#build-silver-layer-clean--load-erp_loc_a101"></a>
</h1>
<p>So first lets see the table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cid<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_181232.png" alt="Screenshot 2025-03-05 181232.png"></p>
<p>Let‚Äôs see the other table with which we can join the table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cst_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_181500.png" alt="Screenshot 2025-03-05 181500.png"></p>
<p>We can see in the crm_cust_info table the cst_key column didn‚Äôt separated by ‚Äò‚Äô-‚Äù but in the erp_loc_a101 table the cid have separated by ‚Äú-‚Äù for an example
in cid ‚Üí AW-00011015 but in cst_key ‚Äî&gt; AW00011015 so we need to remove ‚Äú-‚Äù from cid column value</p>
<p>We are going to use <strong>REPLACE() to replace ‚Äú-‚Äù with ‚Äú‚Äù</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff">
</span></span></span></code></pre></div><p>After it gets replaced we can check whether we could merge the table with silver.crm_cust_info table using cst_key column. I have checked it did work.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">NOT</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span>cst_key<span style="color:#fff"> </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span></code></pre></div><p>Now, after cid column is fixed let‚Äôs move on to cntry col let‚Äôs check first Unique value in the cntry</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_182434.png" alt="Screenshot 2025-03-05 182434.png"></p>
<p>Above we can we do have lot of unique values which is not good for Data standardization &amp; Consistency</p>
<p>Let‚Äôs handle this using CASE WHEN</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">--- Using below CASE WHEN we can handle our issue
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;DE&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Germany&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;US&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;USA&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;United States&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>cntry<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">--- FULL code
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;DE&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Germany&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;US&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;USA&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;United States&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>cntry<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="now-we-have-done-with-this-table-lets-insert-to-silver-layer">Now we have done with this table let‚Äôs insert to silver layer
  <a href="#now-we-have-done-with-this-table-lets-insert-to-silver-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">INSERT</span><span style="color:#fff"> </span><span style="color:#cf222e">INTO</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cid<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">REPLACE</span><span style="color:#1f2328">(</span>cid<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;DE&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;Germany&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">IN</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;US&#39;</span><span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;USA&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;United States&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cntry<span style="color:#1f2328">)</span><span style="color:#0550ae">=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>cntry<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		  </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff">
</span></span></span></code></pre></div><p>let‚Äôs recheck for Quality purpose.</p>
<hr>




<h1 id="build-silver-layer-clean--load-erp_ex_cat_g1v2">Build Silver Layer Clean &amp; Load erp_ex_cat_g1v2
  <a href="#build-silver-layer-clean--load-erp_ex_cat_g1v2"></a>
</h1>
<p>So first lets see the table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cat<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>subcat<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_184759.png" alt="Screenshot 2025-03-05 184759.png"></p>
<p>you can check the data quality using below code.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for unwanted spaces
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cat<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cat<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>subcat<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>subcat<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>maintenance<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>maintenance<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span>subcat<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff">
</span></span></span></code></pre></div><p>I have everything is good so only thing is left to insert into silver layer</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">INSERT</span><span style="color:#fff"> </span><span style="color:#cf222e">INTO</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cat<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>subcat<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cat<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>subcat<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="using-below-you-can-check-the-quality-check-for-your-silver-layer">Using below you can check the Quality check for your silver layer.
  <a href="#using-below-you-can-check-the-quality-check-for-your-silver-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#57606a">/*
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">===============================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">Quality Checks
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">===============================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">Script Purpose:
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    This script performs various quality checks for data consistency, accuracy,
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    and standardization across the &#39;silver&#39; layer. It includes checks for:
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Null or duplicate primary keys.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Unwanted spaces in string fields.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Data standardization and consistency.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Invalid date ranges and orders.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Data consistency between related fields.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">Usage Notes:
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Run these checks after data loading Silver Layer.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">    - Investigate and resolve any discrepancies found during the checks.
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">===============================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">*/</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Checking &#39;silver.crm_cust_info&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Check for NULLs or Duplicates in Primary Key
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for Unwanted Spaces
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cst_key<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cst_marital_status<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Checking &#39;silver.crm_prd_info&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Check for NULLs or Duplicates in Primary Key
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>prd_id<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for Unwanted Spaces
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_nm<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>prd_nm<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for NULLs or Negative Values in Cost
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff"> </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>prd_cost<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for Invalid Date Orders (Start Date &gt; End Date)
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span>prd_start_dt<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Checking &#39;silver.crm_sales_details&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Check for Invalid Dates
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Invalid Dates
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">NULLIF</span><span style="color:#1f2328">(</span>sls_due_dt<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>bronze<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>LEN<span style="color:#1f2328">(</span>sls_due_dt<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0550ae">8</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">20500101</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span><span style="color:#0550ae">19000101</span><span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check for Invalid Date Orders (Order Date &gt; Shipping/Due Dates)
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_order_dt<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>sls_due_dt<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Check Data Consistency: Sales = Quantity * Price
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_sales<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_sales<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_quantity<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>sls_price<span style="color:#fff"> </span><span style="color:#0550ae">&lt;=</span><span style="color:#fff"> </span><span style="color:#0550ae">0</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>sls_sales<span style="color:#1f2328">,</span><span style="color:#fff"> </span>sls_quantity<span style="color:#1f2328">,</span><span style="color:#fff"> </span>sls_price<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Checking &#39;silver.erp_cust_az12&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Identify Out-of-Range Dates
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: Birthdates between 1924-01-01 and Today
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>bdate<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>bdate<span style="color:#fff"> </span><span style="color:#0550ae">&lt;</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;1924-01-01&#39;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>bdate<span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span>GETDATE<span style="color:#1f2328">();</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Checking &#39;silver.erp_loc_a101&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cntry<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Checking &#39;silver.erp_px_cat_g1v2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- ====================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Check for Unwanted Spaces
</span></span></span><span style="display:flex;"><span><span style="color:#57606a">-- Expectation: No Results
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">*</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>cat<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>cat<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>subcat<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>subcat<span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span><span style="color:#cf222e">OR</span><span style="color:#fff"> </span>maintenance<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#cf222e">TRIM</span><span style="color:#1f2328">(</span>maintenance<span style="color:#1f2328">);</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- Data Standardization &amp; Consistency
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#1f2328">;</span><span style="color:#fff">
</span></span></span></code></pre></div><hr>
<hr>




<h1 id="build-gold-layer"><code>Build Gold Layer</code>
  <a href="#build-gold-layer"></a>
</h1>




<h2 id="create-dimension-customers"><code>Create Dimension Customers</code>
  <a href="#create-dimension-customers"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p><img src="dimension_fact.drawio.png" alt="dimension_fact.drawio.png"></p>




<h2 id="explore-the-business-objects"><strong>Explore the Business Objects</strong>
  <a href="#explore-the-business-objects"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p><img src="data_integration.png" alt="data_integration.png"></p>
<p>
<a href="https://www.notion.so" target="_blank" rel="noopener"></a></p>




<h3 id="lets-build-first-customer-table">Let‚Äôs build first customer table
  <a href="#lets-build-first-customer-table"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>So, we need <strong>crm_cust_info</strong>, <strong>erp_cust_az12</strong> &amp; <strong>erp_loc_a101</strong> tables in order to make it one customer table.</p>
<p>First we see with which columns we can join with other table, here we can join <strong>crm_cust_info</strong> table with <strong>erp_cust_az12</strong> on <strong>cst_id = cid</strong> column and same <strong>crm_cust_info</strong> with <strong>erp_loc_a101</strong> on <strong>cst_id = cid.</strong></p>
<p><img src="joings.drawio.png" alt="joings.drawio.png"></p>
<p>Let‚Äôs write a script to apply LEFT JOIN on tables:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_firstname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_lastname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_create_date<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ca<span style="color:#1f2328">.</span>bdate<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ca<span style="color:#1f2328">.</span>gen<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>la<span style="color:#1f2328">.</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ci<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ca<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>ca<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>la<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>la<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_220003.png" alt="Screenshot 2025-03-05 220003.png"></p>
<blockquote>
<p><strong>TIP:  After Joining table, check if any duplicates were introduced by the join logic</strong></p></blockquote>
<p>Here how we can check the duplicates</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_firstname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_lastname<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ci<span style="color:#1f2328">.</span>cst_create_date<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ca<span style="color:#1f2328">.</span>bdate<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>ca<span style="color:#1f2328">.</span>gen<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span>la<span style="color:#1f2328">.</span>cntry<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ci<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ca<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>ca<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>la<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>la<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#1f2328">)</span><span style="color:#fff"> </span>t<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">GROUP</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">HAVING</span><span style="color:#fff"> </span><span style="color:#cf222e">COUNT</span><span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#0550ae">&gt;</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#57606a">-- We don&#39;t get any duplicates dataset which is a good thing.
</span></span></span></code></pre></div><p>Now, Let‚Äôs check the Gender as I can we have two columns related to customer gender let‚Äôs look into it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ca<span style="color:#1f2328">.</span>gen<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ci<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ca<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>ca<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>la<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>la<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span><span style="color:#0550ae">2</span><span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_220437.png" alt="Screenshot 2025-03-05 220437.png"></p>
<p>As we can see sometimes we have different values and sometime NULL or n/a value and above NULL we got it from the Join table NULLs often come from joined tables! NULL will appear if SQL finds no match.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff"> </span><span style="color:#cf222e">DISTINCT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>COALESCE<span style="color:#1f2328">(</span>ca<span style="color:#1f2328">.</span>gen<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>new_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ci<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ca<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>ca<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>la<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>la<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span></code></pre></div><p>Now let‚Äôs look into our new_gen col</p>
<p><img src="image.png" alt="image.png"></p>




<h3 id="now-rename-columns-to-friendly-meaningful-names">Now Rename columns to friendly, meaningful names
  <a href="#now-rename-columns-to-friendly-meaningful-names"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><strong>cst_id    ‚Äî&gt; customer_id</strong></p>
<p><strong>cst_key ‚Äî&gt; customer_number</strong></p>
<p><strong>cst_firstname ‚Äî&gt; fist_name</strong></p>
<p><strong>cst_lastname ‚Äî&gt; last_name</strong></p>
<p><strong>cntry ‚Äî&gt; country</strong></p>
<p><strong>cst_marital_status ‚Äî&gt; marital_status</strong></p>
<p><strong>bdate ‚Äî&gt; birth_date</strong></p>
<p><strong>cst_create_date ‚Äî&gt; create_date</strong></p>




<h3 id="general-principles">General Principles:
  <a href="#general-principles"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>Naming Conventions: Use snake_case, with lowercase letters and underscores(_) to separate words.</strong></li>
<li><strong>Language: Use English for all names.</strong></li>
<li><strong>Avoid Reserved Words: Do not use SQL reserved words as object names.</strong></li>
</ul>




<h3 id="sort-the-columns-into-logical-groups-to-improve-readability">Sort the columns into logical groups to improve readability.
  <a href="#sort-the-columns-into-logical-groups-to-improve-readability"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>customer_number<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_firstname<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>first_name<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_lastname<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>last_name<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>la<span style="color:#1f2328">.</span>cntry<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>country<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_marital_status<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>COALESCE<span style="color:#1f2328">(</span>ca<span style="color:#1f2328">.</span>gen<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>gender<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ca<span style="color:#1f2328">.</span>bdate<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>birthdate<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ci<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ca<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>ca<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>la<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>la<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-05_225118.png" alt="Screenshot 2025-03-05 225118.png"></p>
<p>Let‚Äôs add <strong><code>Surrogate Key</code></strong></p>
<p>System-generated unique identifier , assigned to each record in a table.</p>
<ul>
<li>DDL-based generation.</li>
<li>Query-based using Window function (Row_Number)</li>
</ul>




<h3 id="lets-create-a-view-in-gold-layer">Let‚Äôs create a view in gold layer
  <a href="#lets-create-a-view-in-gold-layer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">VIEW</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_customers<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>cst_id<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>customer_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_id<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>customer_id<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>customer_number<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_firstname<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>first_name<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_lastname<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>last_name<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>la<span style="color:#1f2328">.</span>cntry<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>country<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_marital_status<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>marital_status<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">CASE</span><span style="color:#fff"> </span><span style="color:#cf222e">WHEN</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#fff"> </span><span style="color:#0550ae">!=</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#fff"> </span><span style="color:#cf222e">THEN</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_gndr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">		 </span><span style="color:#cf222e">ELSE</span><span style="color:#fff"> </span>COALESCE<span style="color:#1f2328">(</span>ca<span style="color:#1f2328">.</span>gen<span style="color:#1f2328">,</span><span style="color:#fff"> </span><span style="color:#0a3069">&#39;n/a&#39;</span><span style="color:#1f2328">)</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">END</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>gender<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ca<span style="color:#1f2328">.</span>bdate<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>birthdate<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span>ci<span style="color:#1f2328">.</span>cst_create_date<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>create_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_cust_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ci<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_cust_az12<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>ca<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>ca<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_loc_a101<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>la<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>ci<span style="color:#1f2328">.</span>cst_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>la<span style="color:#1f2328">.</span>cid<span style="color:#fff">
</span></span></span></code></pre></div>



<h3 id="we-have-created-successfully-created-the-view-table-for-dim_customer">We have created successfully created the view table for dim_customer
  <a href="#we-have-created-successfully-created-the-view-table-for-dim_customer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<hr>




<h1 id="build-gold-layer-create-dimension-products"><code>Build Gold Layer Create Dimension Products</code>
  <a href="#build-gold-layer-create-dimension-products"></a>
</h1>
<p>So, first we need to see which column are require in order to join the tables.</p>
<p>We need <strong>cat_id</strong> and <strong>id</strong> in order to join the table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>cat<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>subcat<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pn<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pc<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pc<span style="color:#1f2328">.</span>id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">  </span><span style="color:#57606a">--Filter out all historical date
</span></span></span></code></pre></div><p><img src="Screenshot_2025-03-06_183819.png" alt="Screenshot 2025-03-06 183819.png"></p>




<h3 id="sort-the-columns-into-logical-groups-to-improve-readability-1">Sort the columns into logical groups to improve readability
  <a href="#sort-the-columns-into-logical-groups-to-improve-readability-1"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>prd_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_nm<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>cat<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>subcat<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_start_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pn<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pc<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pc<span style="color:#1f2328">.</span>id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">  </span><span style="color:#57606a">--Filter out all historical date
</span></span></span></code></pre></div>



<h3 id="rename-columns-to-friendly-meaningful-names">Rename columns to friendly, meaningful names
  <a href="#rename-columns-to-friendly-meaningful-names"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>prd_id<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_nm<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_name<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>category_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>cat<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>category<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>subcat<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>subcategory<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_cost<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_line<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_start_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>start_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pn<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pc<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pc<span style="color:#1f2328">.</span>id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">  </span><span style="color:#57606a">--Filter out all historical date
</span></span></span></code></pre></div>



<h2 id="-dimension-vs-fact-"><code>üéè Dimension v/s Fact ??</code>
  <a href="#-dimension-vs-fact-"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>In this case we all have columns which help it describing the products. So, it is dimension not a Fact</p>
<p>Now we have create new primary key for it.</p>
<p><code>ROW_NUMBER() OVER (ORDER BY pn.prd_start_dt, pn_prd_key) AS product_key</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">VIEW</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_products<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">   </span>ROW_NUMBER<span style="color:#1f2328">()</span><span style="color:#fff"> </span>OVER<span style="color:#fff"> </span><span style="color:#1f2328">(</span><span style="color:#cf222e">ORDER</span><span style="color:#fff"> </span><span style="color:#cf222e">BY</span><span style="color:#fff"> </span>pn<span style="color:#1f2328">.</span>prd_start_dt<span style="color:#1f2328">,</span><span style="color:#fff"> </span>pn<span style="color:#1f2328">.</span>prd_key<span style="color:#1f2328">)</span><span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_key<span style="color:#1f2328">,</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>prd_id<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_key<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_nm<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_name<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>category_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>cat<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>category<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>subcat<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>subcategory<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pc<span style="color:#1f2328">.</span>maintenance<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_cost<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cost<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_line<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>product_line<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pn<span style="color:#1f2328">.</span>prd_start_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>start_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_prd_info<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pn<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>erp_px_cat_g1v2<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pc<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff">	 </span>pn<span style="color:#1f2328">.</span>cat_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pc<span style="color:#1f2328">.</span>id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span>prd_end_dt<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">  </span><span style="color:#57606a">--Filter out all historical date
</span></span></span></code></pre></div>



<h1 id="build-gold-layer-create-facts-sales"><code>Build Gold **Layer** Create Facts Sales</code>
  <a href="#build-gold-layer-create-facts-sales"></a>
</h1>
<p>For sales we have only one table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>sd<span style="color:#1f2328">.</span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_prd_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_cust_id<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sd<span style="color:#fff">
</span></span></span></code></pre></div><p>Do we have here Dimension vs Fact??</p>
<p>It is a Fact</p>
<p>We have lot of ids to connect with other table so here we will use those surrogate keys instead of IDs to easily connect facts with dimensions</p>
<p>So this step is called <strong>VLOOKUP</strong></p>
<p>Now, we have to JOIN the crm_sales_details table with both dimension tables and replace the key/id with our surrogate keys.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>sd<span style="color:#1f2328">.</span>sls_ord_num<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pr<span style="color:#1f2328">.</span>product_key<span style="color:#fff">  </span><span style="color:#57606a">-- Dimension Keys
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cu<span style="color:#1f2328">.</span>customer_key<span style="color:#fff">  </span><span style="color:#57606a">-- Dimension Keys
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_order_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_ship_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_due_dt<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_sales<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sd<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_products<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>sd<span style="color:#1f2328">.</span>sls_prd_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pr<span style="color:#1f2328">.</span>product_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_customers<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cu<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>sd<span style="color:#1f2328">.</span>sls_cust_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>cu<span style="color:#1f2328">.</span>customer_id<span style="color:#fff">
</span></span></span></code></pre></div><p>Now rename columns to friendly, meaningful names and also sort the columns into logical groups to improve readability</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>sd<span style="color:#1f2328">.</span>sls_ord_num<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>order_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pr<span style="color:#1f2328">.</span>product_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cu<span style="color:#1f2328">.</span>customer_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_order_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>order_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_ship_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>shipping_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_due_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>due_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sales_amount<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_quantity<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sd<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_products<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>sd<span style="color:#1f2328">.</span>sls_prd_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pr<span style="color:#1f2328">.</span>product_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_customers<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cu<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>sd<span style="color:#1f2328">.</span>sls_cust_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>cu<span style="color:#1f2328">.</span>customer_id<span style="color:#fff">
</span></span></span></code></pre></div><p>Now we can build it to gold.fact_sales</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">CREATE</span><span style="color:#fff"> </span><span style="color:#cf222e">VIEW</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>fact_sales<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">SELECT</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	 </span>sd<span style="color:#1f2328">.</span>sls_ord_num<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>order_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>pr<span style="color:#1f2328">.</span>product_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>cu<span style="color:#1f2328">.</span>customer_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_order_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>order_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_ship_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>shipping_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_due_dt<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>due_date<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_sales<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sales_amount<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_quantity<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>quantity<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">	</span><span style="color:#1f2328">,</span>sd<span style="color:#1f2328">.</span>sls_price<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>price<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">FROM</span><span style="color:#fff"> </span>silver<span style="color:#1f2328">.</span>crm_sales_details<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>sd<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_products<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>pr<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>sd<span style="color:#1f2328">.</span>sls_prd_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>pr<span style="color:#1f2328">.</span>product_number<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_customers<span style="color:#fff"> </span><span style="color:#cf222e">AS</span><span style="color:#fff"> </span>cu<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>sd<span style="color:#1f2328">.</span>sls_cust_id<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>cu<span style="color:#1f2328">.</span>customer_id<span style="color:#fff">
</span></span></span></code></pre></div>



<h2 id="fact-check-check-if-all-dimension-tables-can-successfully-join-to-the-fact-table">|Fact Check: Check if all dimension tables can successfully join to the fact table
  <a href="#fact-check-check-if-all-dimension-tables-can-successfully-join-to-the-fact-table"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#cf222e">select</span><span style="color:#fff"> </span><span style="color:#0550ae">*</span><span style="color:#fff"> </span><span style="color:#cf222e">from</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>fact_sales<span style="color:#fff"> </span>f<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_customers<span style="color:#fff"> </span><span style="color:#cf222e">c</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span><span style="color:#cf222e">c</span><span style="color:#1f2328">.</span>customer_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>f<span style="color:#1f2328">.</span>customer_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">LEFT</span><span style="color:#fff"> </span><span style="color:#cf222e">JOIN</span><span style="color:#fff"> </span>gold<span style="color:#1f2328">.</span>dim_products<span style="color:#fff"> </span>p<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">ON</span><span style="color:#fff"> </span>p<span style="color:#1f2328">.</span>product_key<span style="color:#fff"> </span><span style="color:#0550ae">=</span><span style="color:#fff"> </span>f<span style="color:#1f2328">.</span>product_key<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#cf222e">WHERE</span><span style="color:#fff"> </span><span style="color:#cf222e">c</span><span style="color:#1f2328">.</span>customer_key<span style="color:#fff"> </span><span style="color:#cf222e">IS</span><span style="color:#fff"> </span><span style="color:#cf222e">NULL</span><span style="color:#fff">
</span></span></span></code></pre></div>



<h2 id="data-model-of-start-schema">Data Model of Start Schema
  <a href="#data-model-of-start-schema"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Relationship</p>
<p><img src="data_model.png" alt="data_model.png"></p>




<h1 id="build-gold-layer-data-catalog">Build Gold Layer Data Catalog
  <a href="#build-gold-layer-data-catalog"></a>
</h1>




<h1 id="data-catalog-for-gold-layer">Data Catalog for Gold Layer
  <a href="#data-catalog-for-gold-layer"></a>
</h1>




<h2 id="overview">Overview
  <a href="#overview"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>The Gold Layer is the business-level data representation, structured to support analytical and reporting use cases. It consists of <strong>dimension tables</strong> and <strong>fact tables</strong> for specific business metrics.</p>
<hr>




<h3 id="1-golddim_">1. <strong>gold.dim_customers</strong>
  <a href="#1-golddim_"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>Purpose:</strong> Stores customer details enriched with demographic and geographic data.</li>
<li><strong>Columns:</strong></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Data Type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>customer_key</td>
          <td>INT</td>
          <td>Surrogate key uniquely identifying each customer record in the dimension table.</td>
      </tr>
      <tr>
          <td>customer_id</td>
          <td>INT</td>
          <td>Unique numerical identifier assigned to each customer.</td>
      </tr>
      <tr>
          <td>customer_number</td>
          <td>NVARCHAR(50)</td>
          <td>Alphanumeric identifier representing the customer, used for tracking and referencing.</td>
      </tr>
      <tr>
          <td>first_name</td>
          <td>NVARCHAR(50)</td>
          <td>The customer&rsquo;s first name, as recorded in the system.</td>
      </tr>
      <tr>
          <td>last_name</td>
          <td>NVARCHAR(50)</td>
          <td>The customer&rsquo;s last name or family name.</td>
      </tr>
      <tr>
          <td>country</td>
          <td>NVARCHAR(50)</td>
          <td>The country of residence for the customer (e.g., &lsquo;Australia&rsquo;).</td>
      </tr>
      <tr>
          <td>marital_status</td>
          <td>NVARCHAR(50)</td>
          <td>The marital status of the customer (e.g., &lsquo;Married&rsquo;, &lsquo;Single&rsquo;).</td>
      </tr>
      <tr>
          <td>gender</td>
          <td>NVARCHAR(50)</td>
          <td>The gender of the customer (e.g., &lsquo;Male&rsquo;, &lsquo;Female&rsquo;, &rsquo;n/a&rsquo;).</td>
      </tr>
      <tr>
          <td>birthdate</td>
          <td>DATE</td>
          <td>The date of birth of the customer, formatted as YYYY-MM-DD (e.g., 1971-10-06).</td>
      </tr>
      <tr>
          <td>create_date</td>
          <td>DATE</td>
          <td>The date and time when the customer record was created in the system</td>
      </tr>
  </tbody>
</table>
<hr>




<h3 id="2-golddim_">2. <strong>gold.dim_products</strong>
  <a href="#2-golddim_"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>Purpose:</strong> Provides information about the products and their attributes.</li>
<li><strong>Columns:</strong></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Data Type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>product_key</td>
          <td>INT</td>
          <td>Surrogate key uniquely identifying each product record in the product dimension table.</td>
      </tr>
      <tr>
          <td>product_id</td>
          <td>INT</td>
          <td>A unique identifier assigned to the product for internal tracking and referencing.</td>
      </tr>
      <tr>
          <td>product_number</td>
          <td>NVARCHAR(50)</td>
          <td>A structured alphanumeric code representing the product, often used for categorization or inventory.</td>
      </tr>
      <tr>
          <td>product_name</td>
          <td>NVARCHAR(50)</td>
          <td>Descriptive name of the product, including key details such as type, color, and size.</td>
      </tr>
      <tr>
          <td>category_id</td>
          <td>NVARCHAR(50)</td>
          <td>A unique identifier for the product&rsquo;s category, linking to its high-level classification.</td>
      </tr>
      <tr>
          <td>category</td>
          <td>NVARCHAR(50)</td>
          <td>The broader classification of the product (e.g., Bikes, Components) to group related items.</td>
      </tr>
      <tr>
          <td>subcategory</td>
          <td>NVARCHAR(50)</td>
          <td>A more detailed classification of the product within the category, such as product type.</td>
      </tr>
      <tr>
          <td>maintenance_required</td>
          <td>NVARCHAR(50)</td>
          <td>Indicates whether the product requires maintenance (e.g., &lsquo;Yes&rsquo;, &lsquo;No&rsquo;).</td>
      </tr>
      <tr>
          <td>cost</td>
          <td>INT</td>
          <td>The cost or base price of the product, measured in monetary units.</td>
      </tr>
      <tr>
          <td>product_line</td>
          <td>NVARCHAR(50)</td>
          <td>The specific product line or series to which the product belongs (e.g., Road, Mountain).</td>
      </tr>
      <tr>
          <td>start_date</td>
          <td>DATE</td>
          <td>The date when the product became available for sale or use, stored in</td>
      </tr>
  </tbody>
</table>
<hr>




<h3 id="3-goldfact_">3. <strong>gold.fact_sales</strong>
  <a href="#3-goldfact_"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li><strong>Purpose:</strong> Stores transactional sales data for analytical purposes.</li>
<li><strong>Columns:</strong></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Data Type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>order_number</td>
          <td>NVARCHAR(50)</td>
          <td>A unique alphanumeric identifier for each sales order (e.g., &lsquo;SO54496&rsquo;).</td>
      </tr>
      <tr>
          <td>product_key</td>
          <td>INT</td>
          <td>Surrogate key linking the order to the product dimension table.</td>
      </tr>
      <tr>
          <td>customer_key</td>
          <td>INT</td>
          <td>Surrogate key linking the order to the customer dimension table.</td>
      </tr>
      <tr>
          <td>order_date</td>
          <td>DATE</td>
          <td>The date when the order was placed.</td>
      </tr>
      <tr>
          <td>shipping_date</td>
          <td>DATE</td>
          <td>The date when the order was shipped to the customer.</td>
      </tr>
      <tr>
          <td>due_date</td>
          <td>DATE</td>
          <td>The date when the order payment was due.</td>
      </tr>
      <tr>
          <td>sales_amount</td>
          <td>INT</td>
          <td>The total monetary value of the sale for the line item, in whole currency units (e.g., 25).</td>
      </tr>
      <tr>
          <td>quantity</td>
          <td>INT</td>
          <td>The number of units of the product ordered for the line item (e.g., 1).</td>
      </tr>
      <tr>
          <td>price</td>
          <td>INT</td>
          <td>The price per unit of the product for the line item, in whole currency units (e.g., 25).</td>
      </tr>
  </tbody>
</table>




<h3 id="final-data-flow-diagram">Final Data Flow Diagram
  <a href="#final-data-flow-diagram"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><img src="data_flow.png" alt="data_flow.png"></p>
<hr>

        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">November 12, 2024</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">50 minute read, 10487 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categories:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:1313/categories/sql">SQL</a>  <a href="http://localhost:1313/categories/data-analysis">Data Analysis</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="http://localhost:1313/blog/color-themes/">Style your site colors &rarr;</a>
  
</div>

      </footer>
    </article>
    
      <div class="post-comments pa0 pa4-l mt4">
  
    
      <script src="https://utteranc.es/client.js"
              repo="apreshill/apero"
              issue-term="pathname"
              theme="boxy-light"
              label="comments :crystal_ball:"
              crossorigin="anonymous"
              async
              type="text/javascript">
      </script>
    
  
</div>

    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2025 RStudio, Anywhere
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Ap√©ro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://drive.google.com/drive/u/0/my-drive" title="file-text" target="_blank" rel="me noopener">
      <i class="far fa-file-text fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/shivamchhetry20" title="github" target="_blank" rel="me noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://linkedin.in/shivamkc01" title="linkedin-in" target="_blank" rel="me noopener">
      <i class="fab fa-linkedin-in fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/explore/tags/apero/" title="instagram" target="_blank" rel="me noopener">
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="/license/" title="License">License</a>
      
      <a class="dib pv1 ph2 link" href="/contact/" title="Contact form">Contact</a>
      
      <a class="dib pv1 ph2 link" href="/contributors/" title="Contributors">Contributors</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
